<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="&quot;NOAA's Enterprise Hydrofabric System&quot;
">
<title>Introduction • hydrofabric</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="&quot;NOAA's Enterprise Hydrofabric System&quot;
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrofabric</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NOAA-OWP/hydrofabric/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker, NOAA-Affiliate<br><small class="dont-index">Source: <a href="https://github.com/NOAA-OWP/hydrofabric/blob/HEAD/vignettes/01-intro-deep-dive.Rmd" class="external-link"><code>vignettes/01-intro-deep-dive.Rmd</code></a></small>
      <div class="d-none name"><code>01-intro-deep-dive.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="what-is-a-hydrofabric">What is a hydrofabric?<a class="anchor" aria-label="anchor" href="#what-is-a-hydrofabric"></a>
</h2>
<p>The first question generally raised is, “<em>what is a
hydrofabric</em>?” To date, the term has been been used to describe
artifacts as narrow as a set of cartographic lines, all the way to the
entire spatial data architecture needed to map and model the flow of
water and flood extents. For our purposed here, the hydrofabric is the
foundational base data that allows NextGen to run. It provides</p>
<ul>
<li>the landscape and flow network <em>discritizations</em>
</li>
<li>the <em>connectivity</em> (topology) of the network features</li>
<li>and the locations <em>where information will be reported</em>
(nexus’s)</li>
</ul>
<p>The hydrofabric also establishes a system of <em>linked data</em> and
Web infrastructure that can relate to, and extract from, linked sources
like:</p>
<ul>
<li>the USGS Next Generation Monitoring Location Pages (e.g. <a href="https://waterdata.usgs.gov/monitoring-location/06752260/" class="external-link">here</a>)</li>
<li>The Internet of Water Geoconnex PID registry (e.g. <a href="https://reference.geoconnex.us/collections" class="external-link">here</a>)</li>
<li>climate-catalogs (e.g. <a href="https://github.com/mikejohnson51/climateR-catalogs" class="external-link">here</a>)</li>
<li>landscape characteristic catalogs</li>
</ul>
<p><img src="../reference/figures/what-is-a-hydrofabric.png" width="100%"></p>
<div class="section level3">
<h3 id="who-cares-about-a-hydrofabric">Who cares about a hydrofabric?<a class="anchor" aria-label="anchor" href="#who-cares-about-a-hydrofabric"></a>
</h3>
<p>Discritizing the land surface into computational elements is
fundamental to all modeling tasks. Without it, distributed and lumped
models have no way to apply the needed model formulations or computer
science applications to achieve meaningful results. Therefore anyone who
cares about the science and application of water resource modeling
should care about the underlying data as it drives the locations where
forecasts are made, the attributes that inform a model, and the spatial
elements in which formulation are valid.</p>
<p>However, describing the earths surface - particularly at continental
scales - is a tricky task. Automated techniques can get us a long way in
representation, however the modeling task at hand and local knowledge
should be used in developing an authoritative product. Through time,
local knowledge has been collected in a number of places, but never
centralized. Further, one off products (like the NHDPlus) have been used
to guide all modeling task even in cases when its resolution, or
representation is not well suited.</p>
<p>The aim of NOAAs work in this space is to develop a federal reference
fabric to support all flavors of modeling, and a national instance of
that reference fabric to support heterogeneous model application.</p>
<p>Equally important is the software tools to support flexibility and
community uptake; the data models to support interoperability, community
engagement, and long term stability; and a reference data set with the
quality assurances that when one uses the product they are getting a
well vetted resource that will be able to play nicely with the growing
Ngen framework.</p>
</div>
</div>
<div class="section level2">
<h2 id="current-version">Current Version:<a class="anchor" aria-label="anchor" href="#current-version"></a>
</h2>
<p>The most up to date NextGen hydrofabric and resources can be accessed
from the public facing <a href="https://www.lynker-spatial.com/index.html" class="external-link">Lynker AWS
account</a>.</p>
<p>In practice we strive to develop these products to take advantage of
the following:</p>
<div class="section level4">
<h4 id="leading-data-science">Leading data science<a class="anchor" aria-label="anchor" href="#leading-data-science"></a>
</h4>
<div class="section level5">
<h5 id="formats">Formats:<a class="anchor" aria-label="anchor" href="#formats"></a>
</h5>
<ul>
<li><a href="https://www.geopackage.org" class="external-link">GPKG</a></li>
<li>Arrow/<a href="https://parquet.apache.org/docs/overview/" class="external-link">Parquet</a> Tables</li>
</ul>
</div>
<div class="section level5">
<h5 id="access-patterns">Access Patterns:<a class="anchor" aria-label="anchor" href="#access-patterns"></a>
</h5>
<ul>
<li><a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwil-fWKx_D-AhWCIzQIHXIHDD4QwqsBegQIAxAE&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DauK_gPR-e7M&amp;usg=AOvVaw2ITVtXkwdDj5PCzIfSQwbW" class="external-link">GDAL
VSI</a></li>
<li><a href="https://sqlite.org/index.html" class="external-link">SQLITE</a></li>
<li><a href="https://arrow.apache.org" class="external-link">Arrow</a></li>
</ul>
</div>
<div class="section level5">
<h5 id="distribution-system">Distribution System<a class="anchor" aria-label="anchor" href="#distribution-system"></a>
</h5>
<ul>
<li>
<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html" class="external-link">s3</a>
(through AWS)</li>
<li><a href="https://www.usgs.gov" class="external-link">ScienceBase</a></li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="hydroscience-conceptual-models-web-infastrucutre">Hydroscience Conceptual Models &amp; Web Infastrucutre<a class="anchor" aria-label="anchor" href="#hydroscience-conceptual-models-web-infastrucutre"></a>
</h4>
<ul>
<li>The hydrofabric features are grounded in the OGC <a href="https://docs.opengeospatial.org/is/14-111r6/14-111r6.html" class="external-link">HY
Feature conceptual model</a>.</li>
</ul>
<p><img src="../reference/figures/hyfeature.png" width="100%"></p>
<ul>
<li><p>The <a href="https://www.sciencedirect.com/science/article/pii/S1364815220309841" class="external-link">Mainstems
logical model</a></p></li>
<li><p>The OGC Engineering Report <a href="https://docs.ogc.org/per/22-040.html" class="external-link">“Hydrologic Modeling and
River Corridor Applications of HY_Features Concepts”</a></p></li>
<li><p>The Network Linked Data Index (NLDI) <a href="https://waterdata.usgs.gov/blog/nldi-intro/" class="external-link">here</a>, and <a href="https://rconnect.usgs.gov/dataRetrieval/articles/nldi.html" class="external-link">here</a>
and <a href="https://hyriver.readthedocs.io/en/latest/autoapi/pynhd/pynhd/index.html" class="external-link">here</a></p></li>
<li><p>The <a href="https://geoconnex.internetofwater.dev" class="external-link">Geoconnex
Registry</a></p></li>
</ul>
</div>
<div class="section level4">
<h4 id="formal-realization-representations">Formal Realization Representations<a class="anchor" aria-label="anchor" href="#formal-realization-representations"></a>
</h4>
<ul>
<li>The conceptual model laid out in HY Features is conflated with the
<a href="https://www.ogc.org/standard/sfa/" class="external-link">Simple Feature Access</a>
Spatial Data model to provide a logical model for how the feature
realizations are represented in the hydrofabric data model.</li>
</ul>
<p><img src="../reference/figures/ogc_sfs.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="whats-to-follow">What’s to follow:<a class="anchor" aria-label="anchor" href="#whats-to-follow"></a>
</h2>
<ol style="list-style-type: decimal">
<li>The basic software package for working with these products</li>
<li>The design of this system</li>
<li>The two primary processes of processes of network manipulation -
refactoring and aggregating</li>
<li>The fundamental data model used for hydrofabrics</li>
<li>How to extract subsets of the data for you needs</li>
<li>(time permitting) how to access and build landscape
characteristics</li>
</ol>
<p>As potential users, and contributors, the place where you want to
jump in is use case specific.</p>
<p>The following steps walk you through the concepts and tools for
building and understanding a NextGen ready dataset, what the outputs
look like, and how you might interact with them.</p>
</div>
<div class="section level2">
<h2 id="software">Software<a class="anchor" aria-label="anchor" href="#software"></a>
</h2>
<p>Extracting subsets from the primary hydrofabric data product does not
require code, however, if you are eager to build, modify and expand on
the existing products the</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"NOAA-OWP/hydrofabric"</span><span class="op">)</span></span></code></pre></div>
<p>Hydrofabric itself only contains a few functions for subsetting the
national product. Instead it provides a easy install for a variety of
hydroscience, data science, and spatial libraries that are needed.</p>
<p>Attaching this library, similar to the <code>tidyverse</code>,
installs and loads a canon of software designed to manipulate, modify,
describe, process, and quantify hydrologic networks and land surface
attributes:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NOAA-OWP/hydrofabric" class="external-link">hydrofabric</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching packages</span> ────────────────────────────────────── hydrofabric0.0.6 ──</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr        </span> 1.1.3        <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">hydrofab     </span> 0.5.0   </span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">terra        </span> 1.7.55       <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">zonal        </span> 0.0.2   </span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ngen.hydrofab</span> 0.0.3        <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">glue         </span> 1.6.2   </span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">climateR     </span> 0.3.1.<span style="color: #BB0000;">4</span>      <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">arrow        </span> 13.0.0.<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">nhdplusTools </span> 1.0.1</span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ──────────────────────────────────────── hydrofabric_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">arrow</span>::<span style="color: #00BB00;">buffer()</span>    masks <span style="color: #0000BB;">terra</span>::buffer()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">terra</span>::<span style="color: #00BB00;">intersect()</span> masks <span style="color: #0000BB;">dplyr</span>::intersect()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">glue</span>::<span style="color: #00BB00;">trim()</span>       masks <span style="color: #0000BB;">terra</span>::trim()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">terra</span>::<span style="color: #00BB00;">union()</span>     masks <span style="color: #0000BB;">dplyr</span>::union()</span></span></code></pre>
<p>It includes the following:</p>
<table class="table">
<colgroup>
<col width="46%">
<col width="53%">
</colgroup>
<thead><tr class="header">
<th>Repo</th>
<th align="center">Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>USGS-R/nhdplusTools</td>
<td align="center">Tools for for network manipulation</td>
</tr>
<tr class="even">
<td>NOAA-OWP/hydrofab</td>
<td align="center">Tools for working with the reference fabric, along
with network refactoring and aggregation</td>
</tr>
<tr class="odd">
<td>NOAA-OWP/ngen.hydrofab</td>
<td align="center">Extensions for building NextGen ready data
products</td>
</tr>
<tr class="even">
<td>mikejohnson51/climateR</td>
<td align="center">Tools for for accessing remote data resources for
parameter and attributes estimation</td>
</tr>
<tr class="odd">
<td>mikejohnson51/zonal</td>
<td align="center">Tools for rapid areal summarization</td>
</tr>
<tr class="even">
<td>dplyr</td>
<td align="center">Provides a consistent set of tools for data
manipulation</td>
</tr>
<tr class="odd">
<td>sf</td>
<td align="center">Provides simple features access for R</td>
</tr>
<tr class="even">
<td>terra</td>
<td align="center">Methods for spatial data analysis with vector
(points, lines, polygons) and raster (grid) data</td>
</tr>
<tr class="odd">
<td>arrow</td>
<td align="center">Exposes an interface to the Arrow C++ library</td>
</tr>
<tr class="even">
<td>glue</td>
<td align="center">Provides interpreted string literals that are small,
fast, and dependency-free</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="todays-context">Today’s Context<a class="anchor" aria-label="anchor" href="#todays-context"></a>
</h2>
<p>Everyone should consider a USGS Gage ID in mind. For my example, we
will use NWIS <code>gage=06752260</code> that sits on the Cache La
Poudre River in Fort Collins, Colorado.</p>
<ul>
<li><p>The associated gpkg can be found <a href="https://lynker-spatial.s3.amazonaws.com/tutorial/poudre.gpkg" class="external-link">here</a></p></li>
<li><p>The USGS Next Generation Monitoring Location Page for this site
is here: <a href="https://waterdata.usgs.gov/monitoring-location/06752260/" class="external-link uri">https://waterdata.usgs.gov/monitoring-location/06752260/</a></p></li>
<li><p>The Geoconnex PID can be found here: <a href="https://reference.geoconnex.us/collections/gages/items?provider_id=06752260" class="external-link uri">https://reference.geoconnex.us/collections/gages/items?provider_id=06752260</a></p></li>
</ul>
<p><img src="../reference/figures/hydrofabric.png" width="100%"></p>
<p>For those cases where we need to download data, we are also setting
up a directory in our main working directory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"cihro-data"</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/mikejohnson51" class="external-link">Mike Johnson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
