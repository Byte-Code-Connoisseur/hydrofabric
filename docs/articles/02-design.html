<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='"The Reference Fabric"
'>
<title>NOAA's Enterprise Hydrofabric System • hydrofabric</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NOAA's Enterprise Hydrofabric System">
<meta property="og:description" content='"The Reference Fabric"
'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrofabric</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NOAA-OWP/hydrofabric/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="02-design_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="02-design_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="02-design_files/datatables-binding-0.23/datatables.js"></script><link href="02-design_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="02-design_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="02-design_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="02-design_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="02-design_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>NOAA's Enterprise Hydrofabric System</h1>
                        <h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker,
NOAA-Affiliate<br><h4 data-toc-skip class="author">David
Blodgett</h4>
            <address class="author_afil">
      USGS
WMA<br><h4 data-toc-skip class="author">Andy
Bock</h4>
            <address class="author_afil">
      USGS WMA<br><small class="dont-index">Source: <a href="https://github.com/NOAA-OWP/hydrofabric/blob/HEAD/vignettes/02-design.Rmd" class="external-link"><code>vignettes/02-design.Rmd</code></a></small>
      <div class="d-none name"><code>02-design.Rmd</code></div>
    </address>
</address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="how-do-we-arrive-at-the-nextgen-hydrofabric">How do we arrive at the NextGen Hydrofabric?<a class="anchor" aria-label="anchor" href="#how-do-we-arrive-at-the-nextgen-hydrofabric"></a>
</h2>
<ul>
<li><p>The NextGen model engine is intended to be <em>model
agnostic</em>.</p></li>
<li><p>The hydrofabric is meant to be <em>Model Application
Agnostic</em>.</p></li>
<li>
<p>This means that the hydrofabric should be able to support the
modeling needs of applications like:</p>
<ol style="list-style-type: decimal">
<li>NOAA NextGen (in its infinite flavors);</li>
<li>the USGS NHM;</li>
<li>the USGS SPPARROW model;</li>
<li>and eventually NOAA FIM.</li>
</ol>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-usgs-noaa-reference-fabric">The USGS-NOAA Reference Fabric<a class="anchor" aria-label="anchor" href="#the-usgs-noaa-reference-fabric"></a>
</h2>
<ul>
<li><p>For a single system to serve many - often distinct - modeling
applications, there needs to be a set reference system. (analogous to a
coordinate reference system (CRS))</p></li>
<li>
<p>This reference system must provide the maximum (e.g. smallest
discretization) set of features “allowable” for all interrelated model
applications.</p>
<ul>
<li>Right now, this is the NHDPlusV2 (with modifications)</li>
<li>In the future it will move to NHDHighRes and 3DHP</li>
<li>In practice, reference fabrics can be built from other hydrographies
(e.g. NGA TDX and MERIT)</li>
</ul>
</li>
<li><p>A refernence fabric is key to providing persistent identification
(PID) for durable data integration and model interoprobility</p></li>
<li><p>The development of this product has been collaborative venture
between the USGS Water Mission Area, the NOAA Office of Water
Prediction, and Lynker.</p></li>
</ul>
<p><img src="../reference/figures/logos.png" width="898"></p>
<p>More on this has been documented <a href="https://waterdata.usgs.gov/blog/hydrofabric/" class="external-link">here</a></p>
<div class="section level4">
<h4 id="the-3-pillars-of-a-reference-fabric">The 3 pillars of a Reference Fabric<a class="anchor" aria-label="anchor" href="#the-3-pillars-of-a-reference-fabric"></a>
</h4>
<p><a href="https://www.sciencebase.gov/catalog/item/60be0e53d34e86b93891012b" class="external-link uri">https://www.sciencebase.gov/catalog/item/60be0e53d34e86b93891012b</a></p>
<p><img src="../reference/figures/level1.png" width="708"></p>
</div>
<div class="section level3">
<h3 id="reference-features">1. Reference Features<a class="anchor" aria-label="anchor" href="#reference-features"></a>
</h3>
<ul>
<li><p>Simple, valid, representations of all <code>flowpath</code> and
<code>divide</code> features</p></li>
<li><p>Must be derived from a <em>source</em> hydrographic dataset
(e.g. NHDPLus, or)</p></li>
<li>
<p>Currently, these are built out from the NHDPlusV2 features</p>
<ul>
<li>
<strong>Waterbodies</strong> are simplified, islands are dissolved,
and they are unioned on GNIS_ID.</li>
<li>
<strong>Flowlines</strong> are ensured to be digitized from upsteam
to downstream</li>
<li>
<strong>Catchments</strong> are simplifed, and DEM fragments are
dissolved into the proper adjoing catchments.</li>
</ul>
</li>
<li><p>These data products can be found <a href="https://www.sciencebase.gov/catalog/item/6317a72cd34e36012efa4e8a" class="external-link">here</a></p></li>
</ul>
</div>
<div class="section level3">
<h3 id="reference-topology">2. Reference Topology<a class="anchor" aria-label="anchor" href="#reference-topology"></a>
</h3>
<ul>
<li>Since its first release, the NHDPlus topology and value added
attributes have been stable</li>
<li>Local groups and agencies have made modifications to this but these
have never made it back into the primary source</li>
<li>Improvements made by the USGS, OWP, NCAR have been integrated to
provide an updated network connectivity.</li>
<li>These data products can be found <a href="https://www.sciencebase.gov/catalog/item/63cb311ed34e06fef14f40a3" class="external-link">here</a>
</li>
</ul>
<p><img src="../reference/figures/figure6.png" width="620"></p>
<p><img src="../reference/figures/figure8.png" width="614"></p>
<p><img src="../reference/figures/figure9.png" width="613"></p>
<ul>
<li>“Generating a reference flow network with improved connectivity to
support durable data integration and reproducibility in the coterminous
US” {In press}</li>
</ul>
<p><img src="../reference/figures/figure7.png" width="639"></p>
</div>
<div class="section level3">
<h3 id="reference-pois">3. Reference POIs<a class="anchor" aria-label="anchor" href="#reference-pois"></a>
</h3>
<ul>
<li>Collected from a variety of of published data sources</li>
</ul>
<pre><code><span><span class="co">## Driver: GPKG </span></span>
<span><span class="co">## Available layers:</span></span>
<span><span class="co">##             layer_name geometry_type features fields             crs_name</span></span>
<span><span class="co">## 1 refactored_flowpaths   Line String    41117      7 NAD83 / Conus Albers</span></span>
<span><span class="co">## 2   refactored_divides Multi Polygon    41115      4 NAD83 / Conus Albers</span></span>
<span><span class="co">## 3        split_divides Multi Polygon      569      2 NAD83 / Conus Albers</span></span>
<span><span class="co">## 4          mapped_POIs         Point     3496     22 NAD83 / Conus Albers</span></span>
<span><span class="co">## 5         lookup_table            NA    65370      4                 &lt;NA&gt;</span></span>
<span><span class="co">## 6    catchment_network            NA    41117      5                 &lt;NA&gt;</span></span></code></pre>
<div id="htmlwidget-52b434864715c5df8344" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-52b434864715c5df8344">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],["438","1003","537","379","491","618","1011","251","810","269","143","703","787","771","585","215","595","310","332","1202","583","12,033"],["438","1003","537","379","491","618","1011","251","810","269","143","703","787","771","585","215","595","310","332","1202","583","12,033"],["49","102","46","38","37","57","86","14","75","47","1","43","10","66","77","5","15","23","9","19","53","872"],["214","163","117","46","61","172","172","46","221","47","73","122","147","197","207","43","57","69","50","179","153","2,556"],["208","111","186","104","184","164","241","227","269","142","137","153","324","345","296","54","166","83","124","431","221","4,170"],["88","30","47","52","30","81","73","37","110","60","60","61","63","114","98","17","40","11","37","128","103","1,340"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>gages<\/th>\n      <th>HUC12<\/th>\n      <th>TE<\/th>\n      <th>NID<\/th>\n      <th>WBIn<\/th>\n      <th>WBOut<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"autoWidth":true,"pageLength":25,"scrollCollapse":true,"dom":"lftp","columnDefs":[{"visible":false,"targets":0},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(row).css({'font-weight':value == 22 ? \"bold\" : null});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script><ul>
<li>POIs become <code>hydrolocations</code> at the <em>outflow</em> of
the linked <code>flowpath</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="what-is-a-vpu">What is a VPU?<a class="anchor" aria-label="anchor" href="#what-is-a-vpu"></a>
</h2>
<p>A VPU is a <strong>V</strong>ector <strong>P</strong>rocessing
<strong>Unit</strong>. The USGS determined these regions when designing
the NHDPlusV2. Since our work builds off the NHDPlusV2, we adopt these
processing units.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">vpu_boundaries</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">21</span>,<span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">vpu_boundaries</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">21</span>,<span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">VPUID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></span>
<span><span class="co">## give correct results for longitude/latitude data</span></span></code></pre>
<p><img src="02-design_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="getting-the-reference-fabric">Getting the reference fabric<a class="anchor" aria-label="anchor" href="#getting-the-reference-fabric"></a>
</h2>
<p>All reference products live on ScienceBase. They can be accessed with
the web interface or can be downloaded programatically. The
<code><a href="https://rdrr.io/pkg/hydrofab/man/get_hydrofabric.html" class="external-link">hydrofab::get_hydrofabric()</a></code> utility will download the most
current geofabric for a Vector Processing Unit (VPU). If the requested
file already exists, the file path will be returned.</p>
<p>As an example, lets use the Geonconnex reference featrues to identify
the location of our Fort Collins, CO gage.</p>
<p>This locations can be joined to the set of VPU boundaries severed
with <code>nhdplusTools</code> to find the correct VPU.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gage</span> <span class="op">=</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">'https://reference.geoconnex.us/collections/gages/items?provider_id=06752260'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gage</span> <span class="op">=</span> <span class="fu">st_join</span><span class="op">(</span><span class="va">gage</span>, <span class="fu">st_transform</span><span class="op">(</span><span class="va">vpu_boundaries</span>, <span class="fu">st_crs</span><span class="op">(</span><span class="va">gage</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">gage</span><span class="op">$</span><span class="va">VPUID</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "10L"</span></span></code></pre>
<p>Here we can download the reference fabric for VPU=10L in the assigned
base directory, and explore the layers contained within:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">&lt;-</span> <span class="st">"tmp-data"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in dir.create(base): 'tmp-data' already exists</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference_gpkg</span> <span class="op">=</span> <span class="fu">get_hydrofabric</span><span class="op">(</span>VPU <span class="op">=</span> <span class="st">"01"</span>, </span>
<span>                                 type <span class="op">=</span> <span class="st">"refactor"</span>,</span>
<span>                                 dir <span class="op">=</span> <span class="va">base</span>,</span>
<span>                                 overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |==                                                                    |   4%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |=========                                                             |  14%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |================                                                      |  24%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |=======================                                               |  34%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |=====================================                                 |  54%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |============================================                          |  64%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |===================================================                   |  74%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |==========================================================            |  84%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="section level2">
<h2 id="working-with-the-geopackages">Working with the Geopackages<a class="anchor" aria-label="anchor" href="#working-with-the-geopackages"></a>
</h2>
<p>The geopackage is a critical file format for sharing this type of
data because it is (1) self containing (2) compact and (3) language
agnostic. There are two broad paths to accessing the data. The first is
a GDAL based approach (in R this is using sf, but in python Fiona or
geopandas works well).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read Options</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">sf</span>, <span class="va">DBI</span>, <span class="va">RSQLite</span>, <span class="va">dplyr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### 1. GDAL/geopackage</span></span>
<span><span class="fu">st_layers</span><span class="op">(</span><span class="va">reference_gpkg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Driver: GPKG </span></span>
<span><span class="co">## Available layers:</span></span>
<span><span class="co">##             layer_name geometry_type features fields             crs_name</span></span>
<span><span class="co">## 1 refactored_flowpaths   Line String    41117      7 NAD83 / Conus Albers</span></span>
<span><span class="co">## 2   refactored_divides Multi Polygon    41115      4 NAD83 / Conus Albers</span></span>
<span><span class="co">## 3        split_divides Multi Polygon      569      2 NAD83 / Conus Albers</span></span>
<span><span class="co">## 4          mapped_POIs         Point     3496     22 NAD83 / Conus Albers</span></span>
<span><span class="co">## 5         lookup_table            NA    65370      4                 &lt;NA&gt;</span></span>
<span><span class="co">## 6    catchment_network            NA    41117      5                 &lt;NA&gt;</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nex</span> <span class="op">=</span> <span class="fu">read_sf</span><span class="op">(</span><span class="va">reference_gpkg</span>, <span class="st">"mapped_POIs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 6 features and 22 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 2009569 ymin: 2883035 xmax: 2029956 ymax: 2967498</span></span>
<span><span class="co">## Projected CRS: NAD83 / Conus Albers</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 23</span></span></span>
<span><span class="co">##         ID    toID set   identifier COMID Type_HUC12 Type_Gages Type_TE Type_NID</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 10<span style="text-decoration: underline;">000</span>000  1.00<span style="color: #949494;">e</span>7 1004…          1 7170… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 10<span style="text-decoration: underline;">000</span>011  1.00<span style="color: #949494;">e</span>7 1000…          2 7179… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 10<span style="text-decoration: underline;">000</span>043  1.00<span style="color: #949494;">e</span>7 1000…          3 7189… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 10<span style="text-decoration: underline;">000</span>053  1.00<span style="color: #949494;">e</span>7 1000…          4 7184… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 10<span style="text-decoration: underline;">000</span>070  1.00<span style="color: #949494;">e</span>7 1000…          5 7200… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 10<span style="text-decoration: underline;">000</span>079  1.00<span style="color: #949494;">e</span>7 1000…          6 7200… 010100020… <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 14 more variables: Type_WBIn &lt;chr&gt;, Type_WBOut &lt;chr&gt;, Type_Conf &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Type_Term &lt;chr&gt;, Type_Elev &lt;chr&gt;, Type_Travel &lt;chr&gt;, nexus &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   snapped &lt;lgl&gt;, TotDASqKM &lt;dbl&gt;, DnHydroseq &lt;int&gt;, type &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   member_COMID &lt;chr&gt;, Type_Con &lt;dbl&gt;, geom &lt;POINT [m]&gt;</span></span></span></code></pre>
<p>The second is as a SQLite database (in R, I am doing this with
RSQLite/DBI/dplyr):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### 2. SQLite/Database</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="va">reference_gpkg</span><span class="op">)</span></span>
<span><span class="fu">dbListTables</span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "catchment_network"                     </span></span>
<span><span class="co">##  [2] "gpkg_contents"                         </span></span>
<span><span class="co">##  [3] "gpkg_extensions"                       </span></span>
<span><span class="co">##  [4] "gpkg_geometry_columns"                 </span></span>
<span><span class="co">##  [5] "gpkg_ogr_contents"                     </span></span>
<span><span class="co">##  [6] "gpkg_spatial_ref_sys"                  </span></span>
<span><span class="co">##  [7] "gpkg_tile_matrix"                      </span></span>
<span><span class="co">##  [8] "gpkg_tile_matrix_set"                  </span></span>
<span><span class="co">##  [9] "lookup_table"                          </span></span>
<span><span class="co">## [10] "mapped_POIs"                           </span></span>
<span><span class="co">## [11] "refactored_divides"                    </span></span>
<span><span class="co">## [12] "refactored_flowpaths"                  </span></span>
<span><span class="co">## [13] "rtree_mapped_POIs_geom"                </span></span>
<span><span class="co">## [14] "rtree_mapped_POIs_geom_node"           </span></span>
<span><span class="co">## [15] "rtree_mapped_POIs_geom_parent"         </span></span>
<span><span class="co">## [16] "rtree_mapped_POIs_geom_rowid"          </span></span>
<span><span class="co">## [17] "rtree_refactored_divides_geom"         </span></span>
<span><span class="co">## [18] "rtree_refactored_divides_geom_node"    </span></span>
<span><span class="co">## [19] "rtree_refactored_divides_geom_parent"  </span></span>
<span><span class="co">## [20] "rtree_refactored_divides_geom_rowid"   </span></span>
<span><span class="co">## [21] "rtree_refactored_flowpaths_geom"       </span></span>
<span><span class="co">## [22] "rtree_refactored_flowpaths_geom_node"  </span></span>
<span><span class="co">## [23] "rtree_refactored_flowpaths_geom_parent"</span></span>
<span><span class="co">## [24] "rtree_refactored_flowpaths_geom_rowid" </span></span>
<span><span class="co">## [25] "rtree_split_divides_geom"              </span></span>
<span><span class="co">## [26] "rtree_split_divides_geom_node"         </span></span>
<span><span class="co">## [27] "rtree_split_divides_geom_parent"       </span></span>
<span><span class="co">## [28] "rtree_split_divides_geom_rowid"        </span></span>
<span><span class="co">## [29] "split_divides"                         </span></span>
<span><span class="co">## [30] "sqlite_sequence"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fpa</span> <span class="op">=</span> <span class="fu">collect</span><span class="op">(</span><span class="fu">tbl</span><span class="op">(</span><span class="va">db</span>, <span class="st">"mapped_POIs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fpa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 24</span></span></span>
<span><span class="co">##     fid       geom       ID    toID set   identifier COMID Type_HUC12 Type_Gages</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;blob&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>000  1.00<span style="color: #949494;">e</span>7 1004…          1 7170… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>011  1.00<span style="color: #949494;">e</span>7 1000…          2 7179… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>043  1.00<span style="color: #949494;">e</span>7 1000…          3 7189… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>053  1.00<span style="color: #949494;">e</span>7 1000…          4 7184… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>070  1.00<span style="color: #949494;">e</span>7 1000…          5 7200… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6 <span style="color: #949494;">&lt;raw </span>29 B<span style="color: #949494;">&gt;</span> 10<span style="text-decoration: underline;">000</span>079  1.00<span style="color: #949494;">e</span>7 1000…          6 7200… 010100020… <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 15 more variables: Type_TE &lt;chr&gt;, Type_NID &lt;chr&gt;, Type_WBIn &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Type_WBOut &lt;chr&gt;, Type_Conf &lt;chr&gt;, Type_Term &lt;chr&gt;, Type_Elev &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Type_Travel &lt;chr&gt;, nexus &lt;chr&gt;, snapped &lt;int&gt;, TotDASqKM &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   DnHydroseq &lt;int&gt;, type &lt;chr&gt;, member_COMID &lt;chr&gt;, Type_Con &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
