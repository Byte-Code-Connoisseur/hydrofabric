[{"path":"/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2021 Mike Johnson Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"what-is-a-hydrofabric","dir":"Articles","previous_headings":"","what":"What is a hydrofabric?","title":"Introduction","text":"first question generally raised , “hydrofabric?” date, term used describe artifacts narrow set cartographic lines, way entire spatial data architecture needed map model flow water flood extents. purposed , hydrofabric foundational base data allows NextGen run. provides landscape flow network discritizations connectivity (topology) network features locations information reported (nexus’s) hydrofabric also establishes system linked data Web infrastructure can relate , extract , linked sources like: USGS Next Generation Monitoring Location Pages (e.g. ) Internet Water Geoconnex PID registry (e.g. ) climate-catalogs (e.g. ) landscape characteristic catalogs","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"who-cares-about-a-hydrofabric","dir":"Articles","previous_headings":"What is a hydrofabric?","what":"Who cares about a hydrofabric?","title":"Introduction","text":"Discritizing land surface computational elements fundamental modeling tasks. Without , distributed lumped models way apply needed model formulations computer science applications achieve meaningful results. Therefore anyone cares science application water resource modeling care underlying data drives locations forecasts made, attributes inform model, spatial elements formulation valid. However, describing earths surface - particularly continental scales - tricky task. Automated techniques can get us long way representation, however modeling task hand local knowledge used developing authoritative product. time, local knowledge collected number places, never centralized. , one products (like NHDPlus) used guide modeling task even cases resolution, representation well suited. aim NOAAs work space develop federal reference fabric support flavors modeling, national instance reference fabric support heterogeneous model application. Equally important software tools support flexibility community uptake; data models support interoperability, community engagement, long term stability; reference data set quality assurances one uses product getting well vetted resource able play nicely growing Ngen framework.","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"current-version","dir":"Articles","previous_headings":"","what":"Current Version:","title":"Introduction","text":"date NextGen hydrofabric resources can accessed public facing Lynker AWS account. practice strive develop products take advantage following:","code":""},{"path":[]},{"path":"/articles/01-intro-deep-dive.html","id":"formats","dir":"Articles","previous_headings":"Current Version: > Leading data science","what":"Formats:","title":"Introduction","text":"GPKG Arrow/Parquet Tables","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"access-patterns","dir":"Articles","previous_headings":"Current Version: > Leading data science","what":"Access Patterns:","title":"Introduction","text":"GDAL VSI SQLITE Arrow","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"distribution-system","dir":"Articles","previous_headings":"Current Version: > Leading data science","what":"Distribution System","title":"Introduction","text":"s3 (AWS) ScienceBase","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"hydroscience-conceptual-models-web-infastrucutre","dir":"Articles","previous_headings":"Current Version:","what":"Hydroscience Conceptual Models & Web Infastrucutre","title":"Introduction","text":"hydrofabric features grounded OGC HY Feature conceptual model.  Mainstems logical model OGC Engineering Report “Hydrologic Modeling River Corridor Applications HY_Features Concepts”  Network Linked Data Index (NLDI) , Geoconnex Registry","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"formal-realization-representations","dir":"Articles","previous_headings":"Current Version:","what":"Formal Realization Representations","title":"Introduction","text":"conceptual model laid HY Features conflated Simple Feature Access Spatial Data model provide logical model feature realizations represented hydrofabric data model.","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"whats-to-follow","dir":"Articles","previous_headings":"","what":"What’s to follow:","title":"Introduction","text":"basic software package working products design system two primary processes processes network manipulation - refactoring aggregating fundamental data model used hydrofabrics extract subsets data needs (time permitting) access build landscape characteristics potential users, contributors, place want jump use case specific. following steps walk concepts tools building understanding NextGen ready dataset, outputs look like, might interact .","code":""},{"path":"/articles/01-intro-deep-dive.html","id":"software","dir":"Articles","previous_headings":"","what":"Software","title":"Introduction","text":"Extracting subsets primary hydrofabric data product require code, however, eager build, modify expand existing products Hydrofabric contains functions subsetting national product. Instead provides easy install variety hydroscience, data science, spatial libraries needed. Attaching library, similar tidyverse, installs loads canon software designed manipulate, modify, describe, process, quantify hydrologic networks land surface attributes: includes following: dplyr | Provides consistent set tools data manipulation | sf | Provides simple features access R | terra | Methods spatial data analysis vector (points, lines, polygons) raster (grid) data | arrow | Exposes interface Arrow C++ library | glue | Provides interpreted string literals small, fast, dependency-free |","code":"remotes::install_github(\"NOAA-OWP/hydrofabric\") library(hydrofabric) ## ── Attaching packages ────────────────────────────────────── hydrofabric0.0.6 ── ## ✔ dplyr         1.1.2      ✔ nhdplusTools  0.6.2  ## ✔ terra         1.7.21     ✔ hydrofab      0.5.0  ## ✔ ngen.hydrofab 0.0.3      ✔ zonal         0.0.2  ## ✔ climateR      0.3.0      ✔ glue          1.6.2 ## ── Conflicts ──────────────────────────────────────── hydrofabric_conflicts() ── ## ✖ terra::intersect() masks dplyr::intersect() ## ✖ glue::trim()       masks terra::trim() ## ✖ terra::union()     masks dplyr::union()"},{"path":"/articles/01-intro-deep-dive.html","id":"todays-context","dir":"Articles","previous_headings":"","what":"Today’s Context","title":"Introduction","text":"Everyone consider USGS Gage ID mind. example, use NWIS gage=06752260 sits Cache La Poudre River Fort Collins, Colorado. associated gpkg can found USGS Next Generation Monitoring Location Page site : https://waterdata.usgs.gov/monitoring-location/06752260/ Geoconnex PID can found : https://reference.geoconnex.us/collections/gages/items?provider_id=06752260  cases need download data, also setting directory main working directory.","code":"dir.create(\"cihro-data\", showWarnings = FALSE)"},{"path":"/articles/01_intro-deep-dive.html","id":"what-is-a-hydrofabric","dir":"Articles","previous_headings":"","what":"What is a hydrofabric?","title":"NOAA's Enterprise Hydrofabric System","text":"first question generally raised , “”hydrofabric”?” date, term used describe artifacts narrow set cartographic lines, way entire spatial data architecture needed map model flow water flood extents. hydrofabric foundation base data allows NextGen run provides landscape flow network discritizations provides connectivity (topology) network features defines locations information reported (nexus’s) hydrofabric also establishes system linked data Web infrastructure Systems like USGS Next Generation Monitoring Location Pages (e.g. ) Internet Water Geoconnex PID registry (e.g. ) climate-catalogs (e.g. )  date hydrofabric data can accessed ","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"who-cares-about-a-hydrofabric","dir":"Articles","previous_headings":"What is a hydrofabric?","what":"Who cares about a hydrofabric?","title":"NOAA's Enterprise Hydrofabric System","text":"Discritizing land surface computational elements fundamental modeling tasks. Without , distributed lumped models way apply needed model formulations computer science applications achieve meaningful results. Therefore anyone cares science application water resource modeling care underlying data drives locations forecasts made, attributes inform model, spatial elements formulation valid. However, describing earths surface - particularly continental scales - tricky task. Automated techniques can get us long way representation, however modeling task hand local knowledge used developing authoritative product. time, local knowledge collected number places, never centralized. , one products (like NHDPlus) used guide modeling task even cases resolution, representation well suited. aim NOAAs work space develop federal reference fabric support flavors modeling, national instance reference fabric support heterogeneous model application. Equally important software tools support flexibility community uptake; data models support interoperability, community engagement, long term stability; reference data set quality assurances one uses product getting well vetted resource able play nicely growing Ngen framework.","code":""},{"path":[]},{"path":[]},{"path":"/articles/01_intro-deep-dive.html","id":"formats","dir":"Articles","previous_headings":"Built Using… > Leading data science","what":"Formats:","title":"NOAA's Enterprise Hydrofabric System","text":"GPKG Arrow/Parquet Tables","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"access-patterns","dir":"Articles","previous_headings":"Built Using… > Leading data science","what":"Access Patterns:","title":"NOAA's Enterprise Hydrofabric System","text":"GDAL VSI SQLITE Arrow","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"distribution-system","dir":"Articles","previous_headings":"Built Using… > Leading data science","what":"Distribution System","title":"NOAA's Enterprise Hydrofabric System","text":"s3 (AWS) ScienceBase","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"hydroscience-conceptual-models","dir":"Articles","previous_headings":"Built Using…","what":"Hydroscience Conceptual Models","title":"NOAA's Enterprise Hydrofabric System","text":"hydrofabric features grounded OGC HY Feature conceptual model.","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"formal-realization-representations","dir":"Articles","previous_headings":"Built Using…","what":"Formal Realization Representations","title":"NOAA's Enterprise Hydrofabric System","text":"conceptual model laid HY Features conflated Simple Feature Access Spatial Data model provide logical model feature realizations represented hydrofabric data model.","code":""},{"path":"/articles/01_intro-deep-dive.html","id":"whats-to-follow","dir":"Articles","previous_headings":"","what":"What’s to follow:","title":"NOAA's Enterprise Hydrofabric System","text":"basic software package working products design make system two primary processes processes network manipulation - refactoring aggregating fundamental data model used hydrofabrics extract subsets data needs (time permitting) access build landscape characteristics workshop illustrate toolset working established reference fabric create Ngen ready data products. following steps walk concepts tools building Ngen ready dataset, outputs look like, might interact . Attaching library, similar tidyverse, installs loads canon software designed manipulate, modify, describe, process, quantify hydrologic networks land surface attributes: includes following:","code":"remotes::install_github(\"NOAA-OWP/hydrofabric\") library(hydrofabric) ## ── Attaching packages ────────────────────────────────────── hydrofabric0.0.6 ── ## ✔ dplyr         1.1.2      ✔ nhdplusTools  0.6.2  ## ✔ terra         1.7.21     ✔ hydrofab      0.5.0  ## ✔ ngen.hydrofab 0.0.3      ✔ zonal         0.0.2  ## ✔ climateR      0.3.0      ✔ glue          1.6.2 ## ── Conflicts ──────────────────────────────────────── hydrofabric_conflicts() ── ## ✖ terra::intersect() masks dplyr::intersect() ## ✖ glue::trim()       masks terra::trim() ## ✖ terra::union()     masks dplyr::union() ##  ## Attaching package: 'hydrofabric' ## The following object is masked _by_ 'package:hydrofab': ##  ##     subset_network"},{"path":"/articles/01_intro-deep-dive.html","id":"todays-context","dir":"Articles","previous_headings":"","what":"Today’s Context","title":"NOAA's Enterprise Hydrofabric System","text":"Everyone asked come USGS Gage ID mind. example, use NWIS gage=06752260. sits Cache La Poudre River FORT COLLINS, CO USGS Next Generation Monitoring Location Page : https://waterdata.usgs.gov/monitoring-location/06752260/ Geoconnex PID can found : https://reference.geoconnex.us/collections/gages/items?provider_id=06752260","code":"xx = dataRetrieval::findNLDI(nwis = '06752260', find = c(\"flowlines\", \"basin\"), nav = \"UM\", distance_km = 1000)  mapview(xx)"},{"path":"/articles/02-design-deep-dive.html","id":"how-do-we-arrive-at-the-nextgen-hydrofabric","dir":"Articles","previous_headings":"","what":"How do we arrive at the NextGen Hydrofabric?","title":"The Reference Fabric","text":"NextGen model engine intended model agnostic. hydrofabric meant Model Application Agnostic. means hydrofabric able support modeling needs applications like: NOAA NextGen (infinite flavors); USGS NHM; USGS SPPARROW model; eventually NOAA FIM.","code":""},{"path":"/articles/02-design-deep-dive.html","id":"the-usgs-noaa-reference-fabric","dir":"Articles","previous_headings":"","what":"The USGS-NOAA Reference Fabric","title":"The Reference Fabric","text":"single system serve many - often distinct - modeling applications, needs set reference system. (analogous coordinate reference system (CRS)) reference system must provide maximum (e.g. smallest discretization) set features “allowable” interrelated model applications. Right now, NHDPlusV2 (modifications) future move NHDHighRes 3DHP practice, reference fabrics can built hydrographies (e.g. NGA TDX MERIT) reference fabric key providing persistent identification (PID) durable data integration model interoperability development product collaborative venture USGS Water Mission Area, NOAA Office Water Prediction, Lynker.  documented core data available ","code":""},{"path":[]},{"path":"/articles/02-design-deep-dive.html","id":"reference-features","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric > The 3 pillars of a Reference Fabric","what":"1. Reference Features","title":"The Reference Fabric","text":"Simple, valid, representations flowpath divide features Must derived source hydrographic dataset (e.g. NHDPLus, ) Currently, built NHDPlusV2 features Waterbodies simplified, islands dissolved, unioned GNIS_ID.   Flowlines ensured digitized upstream downstream burn line events substituted NHDFlowlines headwater catchments data products can foundhere","code":"- **Catchments** are simplifed, and DEM fragments are dissolved into the proper adjoining catchments."},{"path":"/articles/02-design-deep-dive.html","id":"reference-topology","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric > The 3 pillars of a Reference Fabric","what":"2. Reference Topology","title":"The Reference Fabric","text":"Since first release, NHDPlus topology value added attributes stable Local groups agencies made modifications never made back primary source Improvements made USGS, OWP, NCAR others integrated provide updated network connectivity. data product can found described upcoming article “Generating reference flow network improved connectivity support durable data integration reproducibility coterminous US” {press EMS}","code":""},{"path":[]},{"path":"/articles/02-design-deep-dive.html","id":"corrected-divergence-priorities","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric > The 3 pillars of a Reference Fabric > 2. Reference Topology","what":"Corrected divergence priorities","title":"The Reference Fabric","text":"Ultimately changed network shown areas total drainage area 10% different original NHDPlusV2 Network.","code":""},{"path":"/articles/02-design-deep-dive.html","id":"reference-points-of-interest-poi","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric > The 3 pillars of a Reference Fabric","what":"3. Reference Points of Interest (POI)","title":"The Reference Fabric","text":"Points Interest hydrologic modelling collected variety published data sources include ones like Army Corp National Inventory Dams USGS Gages III gage database  POIs become hydrolocations outflow linked flowpath robust hydrologic indexing scheme. NOTE: locations deemed high general interest. guarantee gages, dams, thermoelectric plants community set.","code":""},{"path":"/articles/02-design-deep-dive.html","id":"what-is-a-vpu","dir":"Articles","previous_headings":"","what":"What is a VPU?","title":"The Reference Fabric","text":"VPU Vector Processing Unit. USGS determined regions designing NHDPlusV2. Since work builds NHDPlusV2, adopt processing units.  hydrographic networks VPU-esque discritizations. key source hydrofabric discritization can retained manipulation process. show tiling drainage basin approaches MERIT-hydro, BasinMaker, NGA-TDX-hydro. caption","code":"## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not ## give correct results for longitude/latitude data"},{"path":"/articles/02-design-deep-dive.html","id":"getting-the-reference-fabric","dir":"Articles","previous_headings":"","what":"Getting the reference fabric","title":"The Reference Fabric","text":"reference products live ScienceBase Lynker s3 account. can accessed web interface can downloaded programatically. hydrofab::get_hydrofabric() utility download current geofabric Vector Processing Unit (VPU). example, lets use Geonconnex reference features identify location Fort Collins gage. location can joined set VPU boundaries severed nhdplusTools find correct VPU. requested file already exists, file path returned.","code":"gage = read_sf('https://reference.geoconnex.us/collections/gages/items?provider_id=06752260')  gage = st_join(gage, st_transform(vpu_boundaries, st_crs(gage)))  (gage$VPUID) ## [1] \"10L\" reference_gpkg = get_hydrofabric(VPU = gage$VPUID, type = \"reference\",dir = \"cihro-data\")"},{"path":"/articles/02-design-deep-dive.html","id":"working-with-the-geopackages","dir":"Articles","previous_headings":"","what":"Working with the Geopackages","title":"The Reference Fabric","text":"geopackage critical file format sharing type data (1) self containing (2) compact (3) language agnostic. two broad paths accessing data. first GDAL based approach (R using sf, python Fiona geopandas works well). second SQLite database (R, RSQLite/DBI/dplyr): Ok! , idea reference fabric , made, can get ! next stage learn manipulate reference fabric unique model applications.","code":"# Read Options pacman::p_load(sf, DBI, RSQLite, dplyr)  ### 1. GDAL/geopackage st_layers(reference_gpkg) ## Driver: GPKG  ## Available layers: ##              layer_name geometry_type features fields             crs_name ## 1   reference_waterbody Multi Polygon    21093      6 NAD83 / Conus Albers ## 2   reference_catchment       Polygon   196552      8 NAD83 / Conus Albers ## 3    reference_flowline   Line String   199756     45 NAD83 / Conus Albers ## 4              POIs_10L         Point     8026     14 NAD83 / Conus Albers ## 5    poi_geometry_table         Point     8024      3 NAD83 / Conus Albers ## 6  event_geometry_table         Point      318      5 NAD83 / Conus Albers ## 7     reference_network            NA   199756     20                 <NA> ## 8              poi_data            NA    11516      5                 <NA> ## 9            event_data            NA      320      6                 <NA> ## 10         lookup_table            NA   199830      4                 <NA> nex = read_sf(reference_gpkg, \"POIs_10L\") head(nex) ## Simple feature collection with 6 features and 14 fields ## Geometry type: POINT ## Dimension:     XY ## Bounding box:  xmin: -879917.6 ymin: 2011489 xmax: -865512.8 ymax: 2026539 ## Projected CRS: NAD83 / Conus Albers ## # A tibble: 6 × 15 ##      COMID Type_HUC12   Type_Gages nexus Type_TE Type_WBOut Type_Term Type_Conf ##      <dbl> <chr>        <chr>      <dbl> <chr>        <dbl>     <dbl>     <dbl> ## 1 15995608 101800010701 NA             0 NA              NA        NA        NA ## 2 15995906 101800010203 NA             0 NA              NA        NA   1135428 ## 3 15996024 101800010202 NA             0 NA              NA        NA        NA ## 4 15995532 101800010201 NA             0 NA              NA        NA        NA ## 5 15996694 101800010305 NA             0 NA              NA        NA   1136099 ## 6 15996702 101800010304 NA             0 NA              NA        NA   1136103 ## # ℹ 7 more variables: Type_WBIn <dbl>, Type_NID <chr>, Type_Elev <dbl>, ## #   Type_Travel <dbl>, id <int>, moved <int>, geom <POINT [m]> ### 2. SQLite/Database db <- dbConnect(SQLite(), reference_gpkg) dbListTables(db) ##  [1] \"POIs_10L\"                               ##  [2] \"event_data\"                             ##  [3] \"event_geometry_table\"                   ##  [4] \"gpkg_contents\"                          ##  [5] \"gpkg_extensions\"                        ##  [6] \"gpkg_geometry_columns\"                  ##  [7] \"gpkg_ogr_contents\"                      ##  [8] \"gpkg_spatial_ref_sys\"                   ##  [9] \"gpkg_tile_matrix\"                       ## [10] \"gpkg_tile_matrix_set\"                   ## [11] \"lookup_table\"                           ## [12] \"poi_data\"                               ## [13] \"poi_geometry_table\"                     ## [14] \"reference_catchment\"                    ## [15] \"reference_flowline\"                     ## [16] \"reference_network\"                      ## [17] \"reference_waterbody\"                    ## [18] \"rtree_POIs_10L_geom\"                    ## [19] \"rtree_POIs_10L_geom_node\"               ## [20] \"rtree_POIs_10L_geom_parent\"             ## [21] \"rtree_POIs_10L_geom_rowid\"              ## [22] \"rtree_event_geometry_table_geom\"        ## [23] \"rtree_event_geometry_table_geom_node\"   ## [24] \"rtree_event_geometry_table_geom_parent\" ## [25] \"rtree_event_geometry_table_geom_rowid\"  ## [26] \"rtree_poi_geometry_table_geom\"          ## [27] \"rtree_poi_geometry_table_geom_node\"     ## [28] \"rtree_poi_geometry_table_geom_parent\"   ## [29] \"rtree_poi_geometry_table_geom_rowid\"    ## [30] \"rtree_reference_catchment_geom\"         ## [31] \"rtree_reference_catchment_geom_node\"    ## [32] \"rtree_reference_catchment_geom_parent\"  ## [33] \"rtree_reference_catchment_geom_rowid\"   ## [34] \"rtree_reference_flowline_geom\"          ## [35] \"rtree_reference_flowline_geom_node\"     ## [36] \"rtree_reference_flowline_geom_parent\"   ## [37] \"rtree_reference_flowline_geom_rowid\"    ## [38] \"rtree_reference_waterbody_geom\"         ## [39] \"rtree_reference_waterbody_geom_node\"    ## [40] \"rtree_reference_waterbody_geom_parent\"  ## [41] \"rtree_reference_waterbody_geom_rowid\"   ## [42] \"sqlite_sequence\" mpoi = collect(tbl(db, \"POIs_10L\"))  head(mpoi) ## # A tibble: 6 × 16 ##     fid       geom    COMID Type_HUC12   Type_Gages nexus Type_TE Type_WBOut ##   <int>     <blob>    <dbl> <chr>        <chr>      <dbl> <chr>        <dbl> ## 1     1 <raw 29 B> 15995608 101800010701 NA             0 NA              NA ## 2     2 <raw 29 B> 15995906 101800010203 NA             0 NA              NA ## 3     3 <raw 29 B> 15996024 101800010202 NA             0 NA              NA ## 4     4 <raw 29 B> 15995532 101800010201 NA             0 NA              NA ## 5     5 <raw 29 B> 15996694 101800010305 NA             0 NA              NA ## 6     6 <raw 29 B> 15996702 101800010304 NA             0 NA              NA ## # ℹ 8 more variables: Type_Term <dbl>, Type_Conf <dbl>, Type_WBIn <dbl>, ## #   Type_NID <chr>, Type_Elev <dbl>, Type_Travel <dbl>, id <int>, moved <int> dbDisconnect(db)"},{"path":"/articles/02-design.html","id":"how-do-we-arrive-at-the-nextgen-hydrofabric","dir":"Articles","previous_headings":"","what":"How do we arrive at the NextGen Hydrofabric?","title":"NOAA's Enterprise Hydrofabric System","text":"NextGen model engine intended model agnostic. hydrofabric meant Model Application Agnostic. means hydrofabric able support modeling needs applications like: NOAA NextGen (infinite flavors); USGS NHM; USGS SPPARROW model; eventually NOAA FIM.","code":""},{"path":"/articles/02-design.html","id":"the-usgs-noaa-reference-fabric","dir":"Articles","previous_headings":"","what":"The USGS-NOAA Reference Fabric","title":"NOAA's Enterprise Hydrofabric System","text":"single system serve many - often distinct - modeling applications, needs set reference system. (analogous coordinate reference system (CRS)) reference system must provide maximum (e.g. smallest discretization) set features “allowable” interrelated model applications. Right now, NHDPlusV2 (modifications) future move NHDHighRes 3DHP practice, reference fabrics can built hydrographies (e.g. NGA TDX MERIT) refernence fabric key providing persistent identification (PID) durable data integration model interoprobility development product collaborative venture USGS Water Mission Area, NOAA Office Water Prediction, Lynker.  documented ","code":""},{"path":"/articles/02-design.html","id":"the-3-pillars-of-a-reference-fabric","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric","what":"The 3 pillars of a Reference Fabric","title":"NOAA's Enterprise Hydrofabric System","text":"https://www.sciencebase.gov/catalog/item/60be0e53d34e86b93891012b","code":""},{"path":"/articles/02-design.html","id":"reference-features","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric","what":"1. Reference Features","title":"NOAA's Enterprise Hydrofabric System","text":"Simple, valid, representations flowpath divide features Must derived source hydrographic dataset (e.g. NHDPLus, ) Currently, built NHDPlusV2 features Waterbodies simplified, islands dissolved, unioned GNIS_ID. Flowlines ensured digitized upsteam downstream Catchments simplifed, DEM fragments dissolved proper adjoing catchments. data products can found ","code":""},{"path":"/articles/02-design.html","id":"reference-topology","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric","what":"2. Reference Topology","title":"NOAA's Enterprise Hydrofabric System","text":"Since first release, NHDPlus topology value added attributes stable Local groups agencies made modifications never made back primary source Improvements made USGS, OWP, NCAR integrated provide updated network connectivity. data products can found    “Generating reference flow network improved connectivity support durable data integration reproducibility coterminous US” {press}","code":""},{"path":"/articles/02-design.html","id":"reference-pois","dir":"Articles","previous_headings":"The USGS-NOAA Reference Fabric","what":"3. Reference POIs","title":"NOAA's Enterprise Hydrofabric System","text":"Collected variety published data sources POIs become hydrolocations outflow linked flowpath.","code":"## Driver: GPKG  ## Available layers: ##             layer_name geometry_type features fields             crs_name ## 1 refactored_flowpaths   Line String    41117      7 NAD83 / Conus Albers ## 2   refactored_divides Multi Polygon    41115      4 NAD83 / Conus Albers ## 3        split_divides Multi Polygon      569      2 NAD83 / Conus Albers ## 4          mapped_POIs         Point     3496     22 NAD83 / Conus Albers ## 5         lookup_table            NA    65370      4                 <NA> ## 6    catchment_network            NA    41117      5                 <NA>"},{"path":"/articles/02-design.html","id":"what-is-a-vpu","dir":"Articles","previous_headings":"","what":"What is a VPU?","title":"NOAA's Enterprise Hydrofabric System","text":"VPU Vector Processing Unit. USGS determined regions designing NHDPlusV2. Since work builds NHDPlusV2, adopt processing units.","code":"ggplot(data = vpu_boundaries[1:21,]) +    geom_sf(data = vpu_boundaries[1:21,]) +    geom_sf_label(aes(label = VPUID)) +    theme_void() ## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not ## give correct results for longitude/latitude data"},{"path":"/articles/02-design.html","id":"getting-the-reference-fabric","dir":"Articles","previous_headings":"","what":"Getting the reference fabric","title":"NOAA's Enterprise Hydrofabric System","text":"reference products live ScienceBase. can accessed web interface can downloaded programatically. hydrofab::get_hydrofabric() utility download current geofabric Vector Processing Unit (VPU). requested file already exists, file path returned. example, lets use Geonconnex reference featrues identify location Fort Collins, CO gage. locations can joined set VPU boundaries severed nhdplusTools find correct VPU. can download reference fabric VPU=10L assigned base directory, explore layers contained within:","code":"gage = read_sf('https://reference.geoconnex.us/collections/gages/items?provider_id=06752260')  gage = st_join(gage, st_transform(vpu_boundaries, st_crs(gage)))  (gage$VPUID) ## [1] \"10L\" base <- \"tmp-data\" dir.create(base) ## Warning in dir.create(base): 'tmp-data' already exists reference_gpkg = get_hydrofabric(VPU = \"01\",                                   type = \"refactor\",                                  dir = base,                                  overwrite = TRUE) ##    |                                                                               |                                                                      |   0%   |                                                                               |                                                                      |   1%   |                                                                               |=                                                                     |   1%   |                                                                               |=                                                                     |   2%   |                                                                               |==                                                                    |   2%   |                                                                               |==                                                                    |   3%   |                                                                               |==                                                                    |   4%   |                                                                               |===                                                                   |   4%   |                                                                               |===                                                                   |   5%   |                                                                               |====                                                                  |   5%   |                                                                               |====                                                                  |   6%   |                                                                               |=====                                                                 |   6%   |                                                                               |=====                                                                 |   7%   |                                                                               |=====                                                                 |   8%   |                                                                               |======                                                                |   8%   |                                                                               |======                                                                |   9%   |                                                                               |=======                                                               |   9%   |                                                                               |=======                                                               |  10%   |                                                                               |=======                                                               |  11%   |                                                                               |========                                                              |  11%   |                                                                               |========                                                              |  12%   |                                                                               |=========                                                             |  12%   |                                                                               |=========                                                             |  13%   |                                                                               |=========                                                             |  14%   |                                                                               |==========                                                            |  14%   |                                                                               |==========                                                            |  15%   |                                                                               |===========                                                           |  15%   |                                                                               |===========                                                           |  16%   |                                                                               |============                                                          |  16%   |                                                                               |============                                                          |  17%   |                                                                               |============                                                          |  18%   |                                                                               |=============                                                         |  18%   |                                                                               |=============                                                         |  19%   |                                                                               |==============                                                        |  19%   |                                                                               |==============                                                        |  20%   |                                                                               |==============                                                        |  21%   |                                                                               |===============                                                       |  21%   |                                                                               |===============                                                       |  22%   |                                                                               |================                                                      |  22%   |                                                                               |================                                                      |  23%   |                                                                               |================                                                      |  24%   |                                                                               |=================                                                     |  24%   |                                                                               |=================                                                     |  25%   |                                                                               |==================                                                    |  25%   |                                                                               |==================                                                    |  26%   |                                                                               |===================                                                   |  26%   |                                                                               |===================                                                   |  27%   |                                                                               |===================                                                   |  28%   |                                                                               |====================                                                  |  28%   |                                                                               |====================                                                  |  29%   |                                                                               |=====================                                                 |  29%   |                                                                               |=====================                                                 |  30%   |                                                                               |=====================                                                 |  31%   |                                                                               |======================                                                |  31%   |                                                                               |======================                                                |  32%   |                                                                               |=======================                                               |  32%   |                                                                               |=======================                                               |  33%   |                                                                               |=======================                                               |  34%   |                                                                               |========================                                              |  34%   |                                                                               |========================                                              |  35%   |                                                                               |=========================                                             |  35%   |                                                                               |=========================                                             |  36%   |                                                                               |==========================                                            |  36%   |                                                                               |==========================                                            |  37%   |                                                                               |==========================                                            |  38%   |                                                                               |===========================                                           |  38%   |                                                                               |===========================                                           |  39%   |                                                                               |============================                                          |  39%   |                                                                               |============================                                          |  40%   |                                                                               |============================                                          |  41%   |                                                                               |=============================                                         |  41%   |                                                                               |=============================                                         |  42%   |                                                                               |==============================                                        |  42%   |                                                                               |==============================                                        |  43%   |                                                                               |==============================                                        |  44%   |                                                                               |===============================                                       |  44%   |                                                                               |===============================                                       |  45%   |                                                                               |================================                                      |  45%   |                                                                               |================================                                      |  46%   |                                                                               |=================================                                     |  46%   |                                                                               |=================================                                     |  47%   |                                                                               |=================================                                     |  48%   |                                                                               |==================================                                    |  48%   |                                                                               |==================================                                    |  49%   |                                                                               |===================================                                   |  49%   |                                                                               |===================================                                   |  50%   |                                                                               |===================================                                   |  51%   |                                                                               |====================================                                  |  51%   |                                                                               |====================================                                  |  52%   |                                                                               |=====================================                                 |  52%   |                                                                               |=====================================                                 |  53%   |                                                                               |=====================================                                 |  54%   |                                                                               |======================================                                |  54%   |                                                                               |======================================                                |  55%   |                                                                               |=======================================                               |  55%   |                                                                               |=======================================                               |  56%   |                                                                               |========================================                              |  56%   |                                                                               |========================================                              |  57%   |                                                                               |========================================                              |  58%   |                                                                               |=========================================                             |  58%   |                                                                               |=========================================                             |  59%   |                                                                               |==========================================                            |  59%   |                                                                               |==========================================                            |  60%   |                                                                               |==========================================                            |  61%   |                                                                               |===========================================                           |  61%   |                                                                               |===========================================                           |  62%   |                                                                               |============================================                          |  62%   |                                                                               |============================================                          |  63%   |                                                                               |============================================                          |  64%   |                                                                               |=============================================                         |  64%   |                                                                               |=============================================                         |  65%   |                                                                               |==============================================                        |  65%   |                                                                               |==============================================                        |  66%   |                                                                               |===============================================                       |  66%   |                                                                               |===============================================                       |  67%   |                                                                               |===============================================                       |  68%   |                                                                               |================================================                      |  68%   |                                                                               |================================================                      |  69%   |                                                                               |=================================================                     |  69%   |                                                                               |=================================================                     |  70%   |                                                                               |=================================================                     |  71%   |                                                                               |==================================================                    |  71%   |                                                                               |==================================================                    |  72%   |                                                                               |===================================================                   |  72%   |                                                                               |===================================================                   |  73%   |                                                                               |===================================================                   |  74%   |                                                                               |====================================================                  |  74%   |                                                                               |====================================================                  |  75%   |                                                                               |=====================================================                 |  75%   |                                                                               |=====================================================                 |  76%   |                                                                               |======================================================                |  76%   |                                                                               |======================================================                |  77%   |                                                                               |======================================================                |  78%   |                                                                               |=======================================================               |  78%   |                                                                               |=======================================================               |  79%   |                                                                               |========================================================              |  79%   |                                                                               |========================================================              |  80%   |                                                                               |========================================================              |  81%   |                                                                               |=========================================================             |  81%   |                                                                               |=========================================================             |  82%   |                                                                               |==========================================================            |  82%   |                                                                               |==========================================================            |  83%   |                                                                               |==========================================================            |  84%   |                                                                               |===========================================================           |  84%   |                                                                               |===========================================================           |  85%   |                                                                               |============================================================          |  85%   |                                                                               |============================================================          |  86%   |                                                                               |=============================================================         |  86%   |                                                                               |=============================================================         |  87%   |                                                                               |=============================================================         |  88%   |                                                                               |==============================================================        |  88%   |                                                                               |==============================================================        |  89%   |                                                                               |===============================================================       |  89%   |                                                                               |===============================================================       |  90%   |                                                                               |===============================================================       |  91%   |                                                                               |================================================================      |  91%   |                                                                               |================================================================      |  92%   |                                                                               |=================================================================     |  92%   |                                                                               |=================================================================     |  93%   |                                                                               |=================================================================     |  94%   |                                                                               |==================================================================    |  94%   |                                                                               |==================================================================    |  95%   |                                                                               |===================================================================   |  95%   |                                                                               |===================================================================   |  96%   |                                                                               |====================================================================  |  96%   |                                                                               |====================================================================  |  97%   |                                                                               |====================================================================  |  98%   |                                                                               |===================================================================== |  98%   |                                                                               |===================================================================== |  99%   |                                                                               |======================================================================|  99%   |                                                                               |======================================================================| 100%"},{"path":"/articles/02-design.html","id":"working-with-the-geopackages","dir":"Articles","previous_headings":"","what":"Working with the Geopackages","title":"NOAA's Enterprise Hydrofabric System","text":"geopackage critical file format sharing type data (1) self containing (2) compact (3) language agnostic. two broad paths accessing data. first GDAL based approach (R using sf, python Fiona geopandas works well). second SQLite database (R, RSQLite/DBI/dplyr):","code":"# Read Options pacman::p_load(sf, DBI, RSQLite, dplyr)  ### 1. GDAL/geopackage st_layers(reference_gpkg) ## Driver: GPKG  ## Available layers: ##             layer_name geometry_type features fields             crs_name ## 1 refactored_flowpaths   Line String    41117      7 NAD83 / Conus Albers ## 2   refactored_divides Multi Polygon    41115      4 NAD83 / Conus Albers ## 3        split_divides Multi Polygon      569      2 NAD83 / Conus Albers ## 4          mapped_POIs         Point     3496     22 NAD83 / Conus Albers ## 5         lookup_table            NA    65370      4                 <NA> ## 6    catchment_network            NA    41117      5                 <NA> nex = read_sf(reference_gpkg, \"mapped_POIs\") head(nex) ## Simple feature collection with 6 features and 22 fields ## Geometry type: POINT ## Dimension:     XY ## Bounding box:  xmin: 2009569 ymin: 2883035 xmax: 2029956 ymax: 2967498 ## Projected CRS: NAD83 / Conus Albers ## # A tibble: 6 × 23 ##         ID    toID set   identifier COMID Type_HUC12 Type_Gages Type_TE Type_NID ##      <dbl>   <dbl> <chr>      <int> <chr> <chr>      <chr>      <chr>   <chr>    ## 1 10000000  1.00e7 1004…          1 7170… 010100020… NA         NA      NA       ## 2 10000011  1.00e7 1000…          2 7179… 010100020… NA         NA      NA       ## 3 10000043  1.00e7 1000…          3 7189… 010100020… NA         NA      NA       ## 4 10000053  1.00e7 1000…          4 7184… 010100020… NA         NA      NA       ## 5 10000070  1.00e7 1000…          5 7200… 010100020… NA         NA      NA       ## 6 10000079  1.00e7 1000…          6 7200… 010100020… NA         NA      NA       ## # ℹ 14 more variables: Type_WBIn <chr>, Type_WBOut <chr>, Type_Conf <chr>, ## #   Type_Term <chr>, Type_Elev <chr>, Type_Travel <chr>, nexus <chr>, ## #   snapped <lgl>, TotDASqKM <dbl>, DnHydroseq <int>, type <chr>, ## #   member_COMID <chr>, Type_Con <dbl>, geom <POINT [m]> ### 2. SQLite/Database db <- dbConnect(SQLite(), reference_gpkg) dbListTables(db) ##  [1] \"catchment_network\"                      ##  [2] \"gpkg_contents\"                          ##  [3] \"gpkg_extensions\"                        ##  [4] \"gpkg_geometry_columns\"                  ##  [5] \"gpkg_ogr_contents\"                      ##  [6] \"gpkg_spatial_ref_sys\"                   ##  [7] \"gpkg_tile_matrix\"                       ##  [8] \"gpkg_tile_matrix_set\"                   ##  [9] \"lookup_table\"                           ## [10] \"mapped_POIs\"                            ## [11] \"refactored_divides\"                     ## [12] \"refactored_flowpaths\"                   ## [13] \"rtree_mapped_POIs_geom\"                 ## [14] \"rtree_mapped_POIs_geom_node\"            ## [15] \"rtree_mapped_POIs_geom_parent\"          ## [16] \"rtree_mapped_POIs_geom_rowid\"           ## [17] \"rtree_refactored_divides_geom\"          ## [18] \"rtree_refactored_divides_geom_node\"     ## [19] \"rtree_refactored_divides_geom_parent\"   ## [20] \"rtree_refactored_divides_geom_rowid\"    ## [21] \"rtree_refactored_flowpaths_geom\"        ## [22] \"rtree_refactored_flowpaths_geom_node\"   ## [23] \"rtree_refactored_flowpaths_geom_parent\" ## [24] \"rtree_refactored_flowpaths_geom_rowid\"  ## [25] \"rtree_split_divides_geom\"               ## [26] \"rtree_split_divides_geom_node\"          ## [27] \"rtree_split_divides_geom_parent\"        ## [28] \"rtree_split_divides_geom_rowid\"         ## [29] \"split_divides\"                          ## [30] \"sqlite_sequence\" fpa = collect(tbl(db, \"mapped_POIs\"))  head(fpa) ## # A tibble: 6 × 24 ##     fid       geom       ID    toID set   identifier COMID Type_HUC12 Type_Gages ##   <int>     <blob>    <dbl>   <dbl> <chr>      <int> <chr> <chr>      <chr>      ## 1     1 <raw 29 B> 10000000  1.00e7 1004…          1 7170… 010100020… NA         ## 2     2 <raw 29 B> 10000011  1.00e7 1000…          2 7179… 010100020… NA         ## 3     3 <raw 29 B> 10000043  1.00e7 1000…          3 7189… 010100020… NA         ## 4     4 <raw 29 B> 10000053  1.00e7 1000…          4 7184… 010100020… NA         ## 5     5 <raw 29 B> 10000070  1.00e7 1000…          5 7200… 010100020… NA         ## 6     6 <raw 29 B> 10000079  1.00e7 1000…          6 7200… 010100020… NA         ## # ℹ 15 more variables: Type_TE <chr>, Type_NID <chr>, Type_WBIn <chr>, ## #   Type_WBOut <chr>, Type_Conf <chr>, Type_Term <chr>, Type_Elev <chr>, ## #   Type_Travel <chr>, nexus <chr>, snapped <int>, TotDASqKM <dbl>, ## #   DnHydroseq <int>, type <chr>, member_COMID <chr>, Type_Con <dbl> dbDisconnect(db)"},{"path":[]},{"path":"/articles/03-processing-deep-dive.html","id":"getting-the-reference-fabric","dir":"Articles","previous_headings":"","what":"Getting the reference fabric","title":"Network Manipulation","text":"reference (precanned) refactored data products live ScienceBase. can accessed web interface can downloaded programatically. hydrofab::get_hydrofabric() utility download current geofabric Vector Processing Unit (VPU). Options include downloading “refactored” (default) “reference” data. requested file already exists, file path returned.","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"example","dir":"Articles","previous_headings":"Getting the reference fabric","what":"Example","title":"Network Manipulation","text":"Define terminal location interest Subset upstream reference fabric using hydrofab::subset_reference","code":"library(hydrofabric)  # Define starting feature by source and ID (nldi_feature = list(featureSource = \"nwis\", featureID = \"06752260\"))  # Use this feature to build a reference subset   # This function uses the NLDI to identify an upstream tributary   # and SQL to extract a subset GPKG subset_reference(nldi_feature = nldi_feature,                   gpkg = get_hydrofabric(VPU = \"10L\",  type = \"reference\", dir = \"cihro-data\"),                  export_gpkg = \"cihro-data/reference.gpkg\")"},{"path":[]},{"path":"/articles/03-processing-deep-dive.html","id":"concept","dir":"Articles","previous_headings":"1) Running the Process: Refactoring","what":"Concept","title":"Network Manipulation","text":"Refactoring geoprocessing workflow seeks Split large long catchments uniform catchment size distribution collapse catchment topology eliminate small catchments fundamental key network resolution lost! means total path length network going , comes . workflow can parameterized using three primary values: might also areas want avoid, , enforce splitting event. can defined following values: POI definition selection model application specific. , ignore aspect. information network, refactor can refactor flowpath network. order reconcile catchment network,set flow accumulation (FAC) flow direction (FDR) grids must provided. reference fabric (e.g. NHDPlusV2), supply national VRT can accessed : s3://nextgen-hydrofabric/DEM-products/{product}.vrt (gridded products) can found ","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"example-1","dir":"Articles","previous_headings":"1) Running the Process: Refactoring","what":"Example","title":"Network Manipulation","text":"","code":"refactor = refactor(gpkg = \"cihro-data/reference.gpkg\",                     split_flines_meters = 10000,                      collapse_flines_meters = 1000,                      collapse_flines_main_meters = 1000,                     fac = '/vsis3/nextgen-hydrofabric/DEM-products/fac.vrt',                     fdr = '/vsis3/nextgen-hydrofabric/DEM-products/fdr.vrt',                     outfile = \"cihro-data/refactor.gpkg\")"},{"path":"/articles/03-processing-deep-dive.html","id":"outputs","dir":"Articles","previous_headings":"1) Running the Process: Refactoring","what":"Outputs","title":"Network Manipulation","text":"get high level understanding happend “refactor”, can look length distributions:  area distributions:  Lastly, look feature count network: Finally, can zoom layer network see changes exist. figure , white edges represent reference catchment network, black edges represent refactored network Since refactoring requires preservation flowpath network, blue lines representative reference refactored network caveat broken different places.","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"running-the-process-aggregating","dir":"Articles","previous_headings":"","what":"2. Running the Process: Aggregating","title":"Network Manipulation","text":"Aggregation primarily divide oriented workflow. collapses network provide new discretization. Two aggregation methods: POIs - define network outlets (NHM SPARROW) statistical distribution, w/o enforced POIs (NextGen).  , hydrolocation POINT layer can passed help direct aggregation, simplicity ignored :","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"example-2","dir":"Articles","previous_headings":"2. Running the Process: Aggregating","what":"Example","title":"Network Manipulation","text":"","code":"aggregate_to_distribution(gpkg = \"cihro-data/refactor.gpkg\",                           ideal_size_sqkm = 10,                            min_length_km = 1,                            min_area_sqkm = 3,                            outfile = \"cihro-data/aggregate.gpkg\")"},{"path":"/articles/03-processing-deep-dive.html","id":"outputs-1","dir":"Articles","previous_headings":"2. Running the Process: Aggregating","what":"Outputs","title":"Network Manipulation","text":"get high level understanding happend “refactor”, can look length distributions:  area distributions:  Finally, can zoom layer network see changes exist. left-hand figure , white edges represent reference catchment network, black edges represent refactored network, red represnet aggregated network right-hand figure, can see blue flowlines (reference refactor) prunned aggregation process.  Lastly, can look cumulative network traits fabric:  refactored output shared Refactored Parent item ScienceBase resource (available ). also avaliable Lynker s3 account ","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"nextgen","dir":"Articles","previous_headings":"","what":"3) NextGen","title":"Network Manipulation","text":"network aggregated scale matching desired hydrologic processes need turn something NextGen can use (modeling task)","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"divergent-topology","dir":"Articles","previous_headings":"3) NextGen","what":"Divergent Topology","title":"Network Manipulation","text":"Nextgen operates [flowpath --> nexus] vs [flowpath --> flowpath] topology due HY Features conceptula catchment 1 inflow draining one outflow. example can seen : caption","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"character-based-indentification","dir":"Articles","previous_headings":"3) NextGen","what":"Character based indentification","title":"Network Manipulation","text":"Nextgen requires integer based identification, like described data model, prefixed character string defining feature Right now, following prefixs used distiguish type model features. following function (1) identifies nexus locations, (2) moves needed (3) applies schema features. can see results opening hydrofabric adding map!","code":"apply_nexus_topology(gpkg = \"cihro-data/aggregate.gpkg\", export_gpkg = \"cihro-data/nextgen.gpkg\") nexus = read_sf(\"cihro-data/nextgen.gpkg\", \"nexus\")   read_hydrofabric(\"cihro-data/nextgen.gpkg\") %>%    mapview() +    nexus"},{"path":"/articles/03-processing-deep-dive.html","id":"extending-nwm-attributes","dir":"Articles","previous_headings":"3) NextGen","what":"Extending NWM attributes","title":"Network Manipulation","text":"core utilities provide series flowpath, divide, nexuses. However, information needed run /NextGen formulations. include following:","code":"sf::st_layers(\"cihro-data/nextgen.gpkg\") #> Driver: GPKG  #> Available layers: #>   layer_name geometry_type features fields             crs_name #> 1    divides       Polygon      380      9 NAD83 / Conus Albers #> 2      nexus         Point      159      4 NAD83 / Conus Albers #> 3  flowpaths   Line String      380     10 NAD83 / Conus Albers"},{"path":"/articles/03-processing-deep-dive.html","id":"lake-attributes","dir":"Articles","previous_headings":"3) NextGen > Extending NWM attributes","what":"Lake Attributes","title":"Network Manipulation","text":"WBOut Hydrolocations mapped NHDPlusWaterBody COMIDs used NWM.","code":""},{"path":"/articles/03-processing-deep-dive.html","id":"flowpath-attributes","dir":"Articles","previous_headings":"3) NextGen","what":"Flowpath Attributes","title":"Network Manipulation","text":"Flowpath attributes extracted Routelink file values length averaged portion length makes refactored/aggregated network example, 75m flowline roughness 0.05 25m flowline roughness 0.2 Flowpaths attributes lake parameters can added pointing set NWM domain files like found ","code":"(n = (.75 * .05) + (.25 * .2)) #> [1] 0.0875 add_flowpath_attributes(\"cihro-data/nextgen.gpkg\", rl_path = \"~/RouteLink_nwm_v2_2_3.nc\") %>%    add_lake_attributes(lake_path = '~/LAKEPARM_CONUS.nc')"},{"path":"/articles/03-processing-deep-dive.html","id":"cfenoah-owp-attributes","dir":"Articles","previous_headings":"3) NextGen","what":"CFE/NOAH-OWP attributes","title":"Network Manipulation","text":"Catchment attribute data needed run formuatations like CFE NOAH-OWP. can computed using following logic. default, code take gridded data supplied soilproperties_CONUS_FullRouting.nc, wrfinput_CONUS, GWBUCKPARM_CONUS_FullRouting.nc computes following summaries:","code":"add_cfe_noahowp_attributes(gpkg        = 'cihro-data/nextgen.gpkg\"',                                   nwm_dir     = \"nwm-data\",                                   outfile     = 'cihro-data/nextgen.gpkg\"/cfe_noahowp.parquet')"},{"path":"/articles/03-processing-deep-dive.html","id":"themeing","dir":"Articles","previous_headings":"3) NextGen > CFE/NOAH-OWP attributes","what":"Themeing","title":"Network Manipulation","text":"option, QGIS QML theming files can added gpkg. default themeing files come hydrofabric can specified/added append_styles utility desired layer_names QGIS, double clicking gpkg file allow select layers load.","code":"append_style(\"cihro-data/nextgen.gpkg\", layer_names = c(\"nexus\", \"hydrolocations\", \"flowpaths\", \"divides\", \"lakes\"))"},{"path":"/articles/03-processing-deep-dive.html","id":"full-run-through","dir":"Articles","previous_headings":"","what":"Full Run-through","title":"Network Manipulation","text":"","code":"reference_gpkg = get_hydrofabric(VPU = \"10L\",  type = \"reference\", dir = \"cihro-data\")  # Define starting feature by source and ID list(featureSource = \"nwis\", featureID = \"06752260\") %>%    # Subset Reference   subset_reference(gpkg = reference_gpkg,                    export_gpkg = \"cihro-data/reference.gpkg\") %>%    refactor(split_flines_meters = 10000,             collapse_flines_meters = 1000,             collapse_flines_main_meters = 1000,            fac = '/vsis3/nextgen-hydrofabric/DEM-products/fac.vrt',            fdr = '/vsis3/nextgen-hydrofabric/DEM-products/fdr.vrt',            outfile = \"cihro-data/refactor.gpkg\") %>%    aggregate_to_distribution(ideal_size_sqkm = 10,                            min_length_km = 1,                            min_area_sqkm = 3,                            outfile = \"cihro-data/aggregate.gpkg\") %>%    apply_nexus_topology(export_gpkg = \"cihro-data/nextgen.gpkg\") %>%    add_flowpath_attributes() %>%   add_lake_attributes(lake_path = '~/LAKEPARM_CONUS.nc') %>%   append_style(layer_names = c(\"nexus\", \"hydrolocations\", \"flowpaths\", \"divides\", \"lakes\"))  add_cfe_noahowp_attributes(gpkg        = 'cihro-data/nextgen.gpkg\"',                            nwm_dir     = \"nwm-data\",                            outfile     = 'cihro-data/cfe_noahowp.parquet')"},{"path":"/articles/03-processing-deep-dive.html","id":"nhdplustools","dir":"Articles","previous_headings":"Full Run-through","what":"nhdplusTools:","title":"Network Manipulation","text":"network manipulations, fundamental network traits change. requires utilities rapidly efficiently recopute key network metric. nhdplusTools package provides option regenerate fly using graph algroithms logic. return get_sorted() utility subsetting section","code":"nhdplusTools::add_plus_network_attributes() nhdplusTools::get_streamorder() nhdplusTools::calculate_total_drainage_area() nhdplusTools::get_sorted() ..."},{"path":"/articles/04-data-model-deep-dive.html","id":"data-model","dir":"Articles","previous_headings":"","what":"Data Model","title":"The NextGen Hydrofabic Data Model","text":"rigorous data model developed provide minimal, yet efficient, types data needed modeling, hydrofabric subsetting, cross walking, indexing. Much design stems OGC report modifications made NextGen modelling application. current data model contains 7 data layers anticipated 8th water bodies. 5 spatial 2 -spatial highlighting value geopackage model:","code":""},{"path":"/articles/04-data-model-deep-dive.html","id":"divides","dir":"Articles","previous_headings":"","what":"1. Divides","title":"The NextGen Hydrofabic Data Model","text":"Divides represent incremental area draining flowpath. one-dimensional, hydrology-specific realization holistic catchment. Geometrically, divide edge bounded inflow outflow nodes forming POLYGON","code":""},{"path":"/articles/04-data-model-deep-dive.html","id":"divide-type","dir":"Articles","previous_headings":"1. Divides","what":"Divide Type","title":"The NextGen Hydrofabic Data Model","text":"Divides provide continuous coverage modeling domain. majority domain dendritic, areas divide flow, , flow divide. example: coastal divide area, flowpath. internally draining region (sink) area, flow path artificial path (canal) flowpath, associated drainage area divide flowpath representation exisit, 1:1 relationship meaning one flowpath representation divide. case numeric ID future, support ability 1:many divide:*flowline* representations","code":"divides = read_sf(poudre, \"divides\") mapview(divides[5,])"},{"path":"/articles/04-data-model-deep-dive.html","id":"flowpaths","dir":"Articles","previous_headings":"","what":"2. Flowpaths","title":"The NextGen Hydrofabic Data Model","text":"flowpath references path moving particle water flowpath can represented edge bounded inflow outflow nodes, associated left-bank right-bank sub-catchment faces. Geometrically, flowpath LINESTRING connecting inflow outflow level sinuosity representation flowpath can change per modeling application straight line “infinity” sinuous","code":"# Read in all flowpaths flowpaths = read_sf(poudre, \"flowpaths\")  # Define outflow outflow  =  slice_max(flowpaths, hydroseq)   mapview(outflow) +    filter(divides, divide_id == outflow$divide_id)"},{"path":"/articles/04-data-model-deep-dive.html","id":"durable-integration","dir":"Articles","previous_headings":"2. Flowpaths","what":"Durable Integration","title":"The NextGen Hydrofabic Data Model","text":"Many fields hydrofabric designed remain resilient refactor/aggregation process. Many related network indexing integration primary one mainstem identifier intended remain persistent across network manipulations data model described detail video Anything mapped shared mainstem ID (observations, models, etc) can shared across realizations become “durable”","code":"# Mainstem Persistent Identifier (pid = glue(\"https://geoconnex.us/ref/mainstems/{outflow$mainstem}\")) ## https://geoconnex.us/ref/mainstems/352913 # Geonconnex PID mainstem read for URL geoconnex_mainstem = read_sf(pid)  # Mainstem defined by membership of the outlets hf_mainstem = filter(flowpaths, mainstem == outflow$mainstem)  # View mapview(geoconnex_mainstem) +    mapview(hf_mainstem, color = \"red\")"},{"path":"/articles/04-data-model-deep-dive.html","id":"nexus","dir":"Articles","previous_headings":"","what":"3. Nexus","title":"The NextGen Hydrofabic Data Model","text":"nexus provides conceptual outlet water contained catchment. locations NextGen exchange information! defined POIs Others defined locations network 1:1 inflow outflow occur Every catchment flows hydro nexus, conversely every location hydrologic system can thought hydro nexus drains catchment(s).","code":""},{"path":"/articles/04-data-model-deep-dive.html","id":"consequense-of-network-aggregation","dir":"Articles","previous_headings":"3. Nexus","what":"Consequense of Network Aggregation","title":"The NextGen Hydrofabic Data Model","text":"one divide/flowpath (e.g. catchment) can contribute single nexus","code":"count = sort(table(divides$toid), decreasing= TRUE)   (example = names(count[count == 3][1])) ## [1] \"nex-278677\" (sub_divides = filter(divides, toid == example)) ## Simple feature collection with 3 features and 9 fields ## Geometry type: MULTIPOLYGON ## Dimension:     XY ## Bounding box:  xmin: -822945 ymin: 1992135 xmax: -814845 ymax: 1998225 ## Projected CRS: NAD83 / Conus Albers ## # A tibble: 3 × 10 ##   divide_id  toid      type  ds_id areasqkm id    lengthkm tot_drainage_areasqkm ## * <chr>      <chr>     <chr> <dbl>    <dbl> <chr>    <dbl>                 <dbl> ## 1 cat-278676 nex-2786… netw…    NA     8.76 wb-2…     5.79                212.   ## 2 cat-302482 nex-2786… netw…    NA    10.8  wb-3…     5.93                 10.8  ## 3 cat-307410 nex-2786… netw…    NA     4.60 wb-3…     3.97                  4.60 ## # ℹ 2 more variables: has_flowline <int>, geom <MULTIPOLYGON [m]>"},{"path":"/articles/04-data-model-deep-dive.html","id":"hydrolocations","dir":"Articles","previous_headings":"","what":"4. Hydrolocations","title":"The NextGen Hydrofabic Data Model","text":"hydrolocation can define location hydrologic significance located “” hydrologic network given dataset, hydrolocations may may associated hydrologic nexus catchment feature. cases, hydro locations typically linearly-referenced defined set flowpaths. Topologically, hydro-location can understood inlet outlet node located end flowpath edge. NextGen design, subset community POIs, treated hydrolocations network refactored aggregated “”. Collectively can help find, link data!","code":"hl = filter(hydrolocations, id == outflow$toid)  glimpse(hl) ## Rows: 1 ## Columns: 7 ## $ hl_id        <chr> \"8118\" ## $ hl_reference <chr> \"Gages\" ## $ hl_link      <chr> \"06752260\" ## $ hl_uri       <chr> \"Gages-06752260\" ## $ hl_position  <chr> \"outflow\" ## $ id           <chr> \"nex-278699\" ## $ geometry     <POINT [m]> POINT (-760037.4 1989138) (pid = glue('https://reference.geoconnex.us/collections/{tolower(hl$hl_reference)}/items?provider_id={hl$hl_link}')) ## https://reference.geoconnex.us/collections/gages/items?provider_id=06752260 pid = read_sf(pid)  glimpse(pid) ## Rows: 1 ## Columns: 13 ## $ id                   <chr> \"1015611\" ## $ fid                  <int> 70633 ## $ subjectof            <chr> \"https://waterdata.usgs.gov/monitoring-location/0… ## $ provider_id          <chr> \"06752260\" ## $ nhdpv2_reach_measure <dbl> 46.32248 ## $ mainstem_uri         <chr> \"https://geoconnex.us/ref/mainstems/352913\" ## $ name                 <chr> \"CACHE LA POUDRE RIVER AT FORT COLLINS, CO\" ## $ uri                  <chr> \"https://geoconnex.us/ref/gages/1015611\" ## $ description          <chr> \"USGS NWIS Stream/River/Lake Site 06752260: CACHE… ## $ provider             <chr> \"https://waterdata.usgs.gov\" ## $ nhdpv2_reachcode     <chr> \"10190007000017\" ## $ nhdpv2_comid         <dbl> 2900003 ## $ geometry             <POINT [°]> POINT (-105.0692 40.58808) #Use the hl_link to extract this weeks rain event instFlow <- dataRetrieval::readNWISdata(   sites = hl$hl_link, service = \"iv\",   parameterCd = \"00060\",   startDate = \"2023-05-10\" )  # Use PID COMID to extract the 42 year NWM flow record nwm21 = nwmTools::readNWMdata(comid = pid$nhdpv2_comid)"},{"path":"/articles/04-data-model-deep-dive.html","id":"multiplicity","dir":"Articles","previous_headings":"4. Hydrolocations","what":"Multiplicity","title":"The NextGen Hydrofabic Data Model","text":"data design hydrolocation location layer intends represent realization POI independently. means can shared hl_id id (nexus location) distinct hl_reference, hl_link","code":"(poi = filter(hydrolocations, hl_id == 7253)) ## Simple feature collection with 3 features and 6 fields ## Geometry type: POINT ## Dimension:     XY ## Bounding box:  xmin: -768368.2 ymin: 1991210 xmax: -768368.2 ymax: 1991210 ## Projected CRS: NAD83 / Conus Albers ## # A tibble: 3 × 7 ##   hl_id hl_reference hl_link  hl_uri hl_position id               geometry ## * <chr> <chr>        <chr>    <chr>  <chr>       <chr>         <POINT [m]> ## 1 7253  HUC12        1019000… HUC12… outflow     nex-… (-768368.2 1991210) ## 2 7253  NID          CO01659… NID-C… outflow     nex-… (-768368.2 1991210) ## 3 7253  WBOut        2897349  WBOut… outflow     nex-… (-768368.2 1991210)"},{"path":"/articles/04-data-model-deep-dive.html","id":"rigorous-community-poi-mapping","dir":"Articles","previous_headings":"4. Hydrolocations","what":"Rigorous community POI mapping","title":"The NextGen Hydrofabic Data Model","text":"geoconnex PID can provide location source data. can see community POI moved slightly integrate reference network:","code":"geoconnex = read_sf('https://reference.geoconnex.us/collections/dams/items?provider_id=CO01659')  mapview(geoconnex, color = \"red\") + poi"},{"path":"/articles/04-data-model-deep-dive.html","id":"network","dir":"Articles","previous_headings":"","what":"5. Network","title":"The NextGen Hydrofabic Data Model","text":"network layer tabular spatial information provides ultimate cross walk NextGen fabric, source hydrofabric, mapped hydrolocations. network key hydroindexing, data query, network subsetting.","code":""},{"path":"/articles/04-data-model-deep-dive.html","id":"example","dir":"Articles","previous_headings":"5. Network","what":"Example:","title":"The NextGen Hydrofabic Data Model","text":"NextGen ID near ? Lets say lived location Laporte, CO can use NLDI map reference fabric point, search reference fabric hf_id merged current network:","code":"pt = st_sfc(st_point(c(-105.14044,  40.62949)), crs = 4326) mapview(pt) (x = findNLDI(location = pt)) ## $origin ## Simple feature collection with 1 feature and 3 fields ## Geometry type: LINESTRING ## Dimension:     XY ## Bounding box:  xmin: -105.1512 ymin: 40.61313 xmax: -105.1206 ymax: 40.62606 ## Geodetic CRS:  WGS 84 ## # A tibble: 1 × 4 ##   sourceName    identifier comid                                        geometry ##   <chr>         <chr>      <chr>                                <LINESTRING [°]> ## 1 NHDPlus comid 2899849    2899849 (-105.1512 40.62592, -105.1489 40.62606, -10… (n = filter(read_sf(poudre, \"network\"), hf_id == x$origin$comid)) ## # A tibble: 1 × 15 ##   id       toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source  hf_id ##   <chr>    <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>      <dbl> ## 1 wb-2786… nex-… cat-2786…    NA   352913 NA       11625 NA     NHDPlusV2 2.90e6 ## # ℹ 5 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr> mapview(filter(flowpaths, id == n$id)) +    filter(divides, divide_id == n$divide_id) +   filter(nexus, id == n$toid) +    pt"},{"path":"/articles/04-data-model-deep-dive.html","id":"flowpath-attributes","dir":"Articles","previous_headings":"","what":"6. Flowpath Attributes","title":"The NextGen Hydrofabic Data Model","text":"Flowpath attributes extracted NWM Routelink file. network layer used “length weight average” attributes new network.","code":""},{"path":"/articles/04-data-model-deep-dive.html","id":"lakes","dir":"Articles","previous_headings":"","what":"7. Lakes","title":"The NextGen Hydrofabic Data Model","text":"Lake attributes extracted NWM Lake file file. network layer used “length weight average” attributes new network.","code":"lakes = read_sf(poudre, \"lakes\") %>%    filter(hl_id == 7253) %>%    glimpse() ## Rows: 1 ## Columns: 18 ## $ id           <chr> \"nex-287191\" ## $ toid         <chr> \"wb-287191\" ## $ hl_id        <chr> \"7253\" ## $ hl_reference <chr> \"WBOut\" ## $ hl_link      <dbl> 2897349 ## $ hl_uri       <chr> \"WBOut-2897349\" ## $ Dam_Length   <dbl> 10 ## $ ifd          <dbl> 0.9 ## $ LkArea       <dbl> 6.87471 ## $ LkMxE        <dbl> 1678.71 ## $ OrificeA     <dbl> 1 ## $ OrificeC     <dbl> 0.1 ## $ OrificeE     <dbl> 1625.35 ## $ time         <dbl> 0 ## $ WeirC        <dbl> 0.4 ## $ WeirE        <dbl> 1670.706 ## $ WeirL        <dbl> 10 ## $ geom         <POINT> POINT (-768368.2 1991210)"},{"path":"/articles/04-data-model-deep-dive.html","id":"layer-style","dir":"Articles","previous_headings":"","what":"8. Layer Style","title":"The NextGen Hydrofabic Data Model","text":"open hydrofabric gpkg created many hydrofab tools, find load consistent symbology. symbologies saved Geopackage using hydrofab::append_style() Built reference QGIS QML files.","code":"read_sf(poudre, \"layer_styles\") %>%  glimpse() ## Rows: 5 ## Columns: 12 ## $ f_table_catalog   <chr> \"\", \"\", \"\", \"\", \"\" ## $ f_table_schema    <chr> \"\", \"\", \"\", \"\", \"\" ## $ f_table_name      <chr> \"divides\", \"nexus\", \"flowpaths\", \"hydrolocations\", \"… ## $ f_geometry_column <chr> \"geom\", \"geom\", \"geom\", \"geom\", \"geom\" ## $ styleName         <chr> \"divides__hydrofabric_style\", \"nexus__hydrofabric_st… ## $ styleQML          <chr> \"<!DOCTYPE qgis PUBLIC 'http://mrcc.com/qgis.dtd' 'S… ## $ styleSLD          <chr> \"\", \"\", \"\", \"\", \"\" ## $ useAsDefault      <lgl> TRUE, TRUE, TRUE, TRUE, TRUE ## $ description       <chr> \"Generated for hydrofabric\", \"Generated for hydrofab… ## $ owner             <chr> \"\", \"\", \"\", \"\", \"\" ## $ ui                <lgl> NA, NA, NA, NA, NA ## $ update_time       <dttm> 2023-05-16 09:25:15, 2023-05-16 09:25:15, 2023-05-16… a = system.file(\"qml\", \"divides.qml\", package = \"hydrofab\")  readLines(a)[1:20] ##  [1] \"<!DOCTYPE qgis PUBLIC 'http://mrcc.com/qgis.dtd' 'SYSTEM'>\"                                                                              ##  [2] \"<qgis version=\\\"3.22.6-Białowieża\\\" styleCategories=\\\"Symbology\\\">\"                                                                      ##  [3] \"  <renderer-v2 enableorderby=\\\"0\\\" attr=\\\"type\\\" forceraster=\\\"0\\\" type=\\\"categorizedSymbol\\\" symbollevels=\\\"0\\\" referencescale=\\\"-1\\\">\" ##  [4] \"    <categories>\"                                                                                                                        ##  [5] \"      <category symbol=\\\"0\\\" value=\\\"coastal\\\" label=\\\"coastal\\\" render=\\\"true\\\"/>\"                                                      ##  [6] \"      <category symbol=\\\"1\\\" value=\\\"network\\\" label=\\\"network\\\" render=\\\"true\\\"/>\"                                                      ##  [7] \"      <category symbol=\\\"2\\\" value=\\\"internal\\\" label=\\\"internal\\\" render=\\\"true\\\"/>\"                                                    ##  [8] \"      <category symbol=\\\"4\\\" value=\\\"terminal\\\" label=\\\"terminal\\\" render=\\\"true\\\"/>\"                                                    ##  [9] \"    <\/categories>\"                                                                                                                       ## [10] \"    <symbols>\"                                                                                                                           ## [11] \"      <symbol name=\\\"0\\\" force_rhr=\\\"0\\\" clip_to_extent=\\\"1\\\" alpha=\\\"1\\\" type=\\\"fill\\\">\"                                                ## [12] \"        <data_defined_properties>\"                                                                                                       ## [13] \"          <Option type=\\\"Map\\\">\"                                                                                                         ## [14] \"            <Option name=\\\"name\\\" value=\\\"\\\" type=\\\"QString\\\"/>\"                                                                         ## [15] \"            <Option name=\\\"properties\\\"/>\"                                                                                               ## [16] \"            <Option name=\\\"type\\\" value=\\\"collection\\\" type=\\\"QString\\\"/>\"                                                               ## [17] \"          <\/Option>\"                                                                                                                     ## [18] \"        <\/data_defined_properties>\"                                                                                                      ## [19] \"        <layer locked=\\\"0\\\" class=\\\"SimpleFill\\\" enabled=\\\"1\\\" pass=\\\"0\\\">\"                                                              ## [20] \"          <Option type=\\\"Map\\\">\""},{"path":"/articles/05-subsetting.html","id":"the-conus-network-file","dir":"Articles","previous_headings":"","what":"The CONUS network file","title":"Building your own subset","text":"Remember, reference, refactor, NextGen products distributed VPU. data products segmented, describe holistic network. easy data discoverabilty, cross-walking, indexing, network layers VPU joined single Parquet file (~80MB size) table ’ll see every relationship features current hydrofabric, source hydrofabric, hydrolocations, exploded “many--many” table. example, can look flowpath wb-1002 find defined aggregation NHDPlusV2 COMID 2239831 2239831. , terminal outflow ‘HUC12-010100100101’ occurs tnx-1000000019 fed aggregate flowpath made three source flowpaths (COMID={816563, 816417, 816415})","code":"net = arrow::read_parquet(\"../data/conus_net.parquet\")  glimpse(net) ## Rows: 3,178,347 ## Columns: 16 ## $ id                    <chr> \"wb-282\", \"wb-282\", \"wb-282\", \"wb-282\", \"wb-2462… ## $ toid                  <chr> \"tnx-1000000171\", \"tnx-1000000171\", \"tnx-1000000… ## $ divide_id             <chr> \"cat-282\", \"cat-282\", \"cat-282\", \"cat-282\", \"cat… ## $ ds_id                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, … ## $ mainstem              <int> 2238463, 2238463, 2238463, 2238463, 2243682, 224… ## $ hl_id                 <chr> NA, NA, NA, NA, \"176\", \"176\", \"176\", \"183\", \"183… ## $ hydroseq              <int> 19980, 19980, 19980, 19980, 19979, 19979, 19979,… ## $ hl_uri                <chr> NA, NA, NA, NA, \"HUC12-010100100101\", \"HUC12-010… ## $ hf_source             <chr> \"NHDPlusV2\", \"NHDPlusV2\", \"NHDPlusV2\", \"NHDPlusV… ## $ hf_id                 <dbl> 4287171, 4287061, 4287169, 4287115, 816563, 8164… ## $ lengthkm              <dbl> 3.695258, 3.695258, 3.695258, 3.695258, 5.135779… ## $ areasqkm              <dbl> 6.786451, 6.786451, 6.786451, 6.786451, 13.28626… ## $ tot_drainage_areasqkm <dbl> 6.786451, 6.786451, 6.786451, 6.786451, 51.65776… ## $ type                  <chr> \"terminal\", \"terminal\", \"terminal\", \"terminal\", … ## $ vpu                   <chr> \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", … ## $ hf_hydroseq           <dbl> 150061851, 150030537, 150035911, 150045246, 1500… filter(net, id == \"wb-1002\") %>%    glimpse() ## Rows: 2 ## Columns: 16 ## $ id                    <chr> \"wb-1002\", \"wb-1002\" ## $ toid                  <chr> \"nex-294\", \"nex-294\" ## $ divide_id             <chr> \"cat-1002\", \"cat-1002\" ## $ ds_id                 <dbl> NA, NA ## $ mainstem              <int> 2239831, 2239831 ## $ hl_id                 <chr> NA, NA ## $ hydroseq              <int> 1927, 1927 ## $ hl_uri                <chr> NA, NA ## $ hf_source             <chr> \"NHDPlusV2\", \"NHDPlusV2\" ## $ hf_id                 <dbl> 4290271, 4290437 ## $ lengthkm              <dbl> 6.291308, 6.291308 ## $ areasqkm              <dbl> 23.06835, 23.06835 ## $ tot_drainage_areasqkm <dbl> 54.84601, 54.84601 ## $ type                  <chr> \"nexus\", \"nexus\" ## $ vpu                   <chr> \"01\", \"01\" ## $ hf_hydroseq           <dbl> 150045065, 150035814 filter(net, hl_uri == 'HUC12-010100100101') %>%    glimpse() ## Rows: 3 ## Columns: 16 ## $ id                    <chr> \"wb-2462\", \"wb-2462\", \"wb-2462\" ## $ toid                  <chr> \"tnx-1000000019\", \"tnx-1000000019\", \"tnx-1000000… ## $ divide_id             <chr> \"cat-2462\", \"cat-2462\", \"cat-2462\" ## $ ds_id                 <dbl> NA, NA, NA ## $ mainstem              <int> 2243682, 2243682, 2243682 ## $ hl_id                 <chr> \"176\", \"176\", \"176\" ## $ hydroseq              <int> 19979, 19979, 19979 ## $ hl_uri                <chr> \"HUC12-010100100101\", \"HUC12-010100100101\", \"HUC… ## $ hf_source             <chr> \"NHDPlusV2\", \"NHDPlusV2\", \"NHDPlusV2\" ## $ hf_id                 <dbl> 816563, 816417, 816415 ## $ lengthkm              <dbl> 5.135779, 5.135779, 5.135779 ## $ areasqkm              <dbl> 13.28626, 13.28626, 13.28626 ## $ tot_drainage_areasqkm <dbl> 51.65776, 51.65776, 51.65776 ## $ type                  <chr> \"terminal\", \"terminal\", \"terminal\" ## $ vpu                   <chr> \"01\", \"01\", \"01\" ## $ hf_hydroseq           <dbl> 150027523, 150024646, 150066278"},{"path":[]},{"path":"/articles/05-subsetting.html","id":"speed","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way?","what":"1. Speed","title":"Building your own subset","text":"","code":"system.time({   net = read_parquet('s3://nextgen-hydrofabric/pre-release/conus_net.parquet') })  #    user  system elapsed  #  2.180   2.123  41.288"},{"path":"/articles/05-subsetting.html","id":"defered-evaluation","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 1. Speed","what":"Defered Evaluation","title":"Building your own subset","text":"times want open entire network limited, often, interested small bits data ","code":"system.time({   net = open_dataset('s3://nextgen-hydrofabric/pre-release/conus_net.parquet') %>%      filter(id == \"wb-1002\") %>%      collect() })  #   user  system elapsed  #  2.294   2.588  24.261"},{"path":[]},{"path":"/articles/05-subsetting.html","id":"by-location","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 2. Feature Identification","what":"By location","title":"Building your own subset","text":"","code":"here = AOI::geocode(\"National Water Center, Alabama\", pt = TRUE)    x = dataRetrieval::findNLDI(location = here)  (filter(net, hf_id == x$origin$comid)) ## # A tibble: 1 × 16 ##   id       toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source  hf_id ##   <chr>    <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>      <dbl> ## 1 wb-1651… nex-… cat-1651…    NA  1724696 NA       14914 NA     NHDPlusV2 1.82e7 ## # ℹ 6 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr>, hf_hydroseq <dbl>"},{"path":"/articles/05-subsetting.html","id":"for-a-gage-in-calfornia","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 2. Feature Identification","what":"For a gage in Calfornia","title":"Building your own subset","text":"","code":"hl = filter(net, hl_uri == \"Gages-11123000\")  (slice_max(hl, hf_hydroseq)) ## # A tibble: 1 × 16 ##   id       toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source  hf_id ##   <chr>    <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>      <dbl> ## 1 wb-3400… nex-… cat-3400…    NA  1839328 3569     30250 Gages… NHDPlusV2 1.76e7 ## # ℹ 6 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr>, hf_hydroseq <dbl>"},{"path":"/articles/05-subsetting.html","id":"for-the-huc12-of-atascadero-creek-in-santa-barbara","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 2. Feature Identification","what":"For the HUC12 of Atascadero Creek in Santa Barbara:","title":"Building your own subset","text":"","code":"hl = filter(net, hl_uri == \"HUC12-180600130201\")  (wbd = slice_max(hl, hf_hydroseq)) ## # A tibble: 1 × 16 ##   id       toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source  hf_id ##   <chr>    <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>      <dbl> ## 1 wb-3400… nex-… cat-3400…    NA  1841917 2281     16722 HUC12… NHDPlusV2 1.76e7 ## # ℹ 6 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr>, hf_hydroseq <dbl>"},{"path":"/articles/05-subsetting.html","id":"for-the-dam-on-horsetooth-reservoir","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 2. Feature Identification","what":"For the dam on Horsetooth Reservoir","title":"Building your own subset","text":"","code":"hl = filter(net, hl_uri == \"NID-CO01659-1\")  (wbd = slice_max(hl, hf_hydroseq)) ## # A tibble: 1 × 16 ##   id       toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source  hf_id ##   <chr>    <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>      <dbl> ## 1 wb-3314… nex-… cat-3314…    NA  1223227 7253     11610 NID-C… NHDPlusV2 2.90e6 ## # ℹ 6 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr>, hf_hydroseq <dbl>"},{"path":"/articles/05-subsetting.html","id":"by-known-comid","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way? > 2. Feature Identification","what":"By known COMID","title":"Building your own subset","text":"","code":"filter(net, hf_id == 101) ## # A tibble: 1 × 16 ##   id        toid  divide_id ds_id mainstem hl_id hydroseq hl_uri hf_source hf_id ##   <chr>     <chr> <chr>     <dbl>    <int> <chr>    <int> <chr>  <chr>     <dbl> ## 1 wb-26052… nex-… cat-2605…    NA  2603469 281        120 HUC12… NHDPlusV2   101 ## # ℹ 6 more variables: lengthkm <dbl>, areasqkm <dbl>, ## #   tot_drainage_areasqkm <dbl>, type <chr>, vpu <chr>, hf_hydroseq <dbl>"},{"path":"/articles/05-subsetting.html","id":"topo-sorting","dir":"Articles","previous_headings":"The CONUS network file > Why do it this way?","what":"3. Topo sorting!","title":"Building your own subset","text":"national network provides opportunity rapid network navigation subsetting. structure CONUS network file also facilitates , precautions taken. “many--many” relationship network file allows fast indexing discovery, duplication feature IDs conducive graph based approaches. Seeking just topology network impractical/wrong Thus, NEED make sure operations running network file dealing distinct rows operations want. case hydrosequencing, unique id/toid pairs complete, non duplicated network, can easily sort subset based defined outlet(s)","code":"# Most downstream feature associated with  (wbd = filter(net, hl_uri == \"HUC12-180600130201\") %>%     select(id, toid, hl_uri, vpu, hydroseq) %>%     slice_max(hydroseq, with_ties = TRUE)) ## # A tibble: 8 × 5 ##   id         toid        hl_uri             vpu   hydroseq ##   <chr>      <chr>       <chr>              <chr>    <int> ## 1 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 2 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 3 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 4 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 5 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 6 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 7 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 ## 8 wb-3400759 nex-3400758 HUC12-180600130201 18       16731 (filter(net, vpu == wbd$vpu[1]) %>%    select(id, toid, divide_id)) ## # A tibble: 170,349 × 3 ##    id         toid           divide_id   ##    <chr>      <chr>          <chr>       ##  1 wb-3378885 tnx-1000012409 cat-3378885 ##  2 wb-3378885 tnx-1000012409 cat-3378885 ##  3 wb-3378885 tnx-1000012409 cat-3378885 ##  4 wb-3378885 tnx-1000012409 cat-3378885 ##  5 wb-3378885 tnx-1000012409 cat-3378885 ##  6 wb-3378885 tnx-1000012409 cat-3378885 ##  7 wb-3378885 tnx-1000012409 cat-3378885 ##  8 wb-3378885 tnx-1000012409 cat-3378885 ##  9 wb-3378885 tnx-1000012409 cat-3378885 ## 10 wb-3378885 tnx-1000012409 cat-3378885 ## # ℹ 170,339 more rows (wbd_net = filter(net, vpu == wbd$vpu) %>%    select(id, toid, divide_id) %>%    distinct()) ## Warning: There was 1 warning in `filter()`. ## ℹ In argument: `vpu == wbd$vpu`. ## Caused by warning in `vpu == wbd$vpu`: ## ! longer object length is not a multiple of shorter object length ## # A tibble: 65,280 × 3 ##    id         toid           divide_id   ##    <chr>      <chr>          <chr>       ##  1 wb-3378885 tnx-1000012409 cat-3378885 ##  2 wb-3378890 tnx-1000013027 cat-3378890 ##  3 wb-3378892 tnx-1000012410 cat-3378892 ##  4 wb-3378895 tnx-1000013028 cat-3378895 ##  5 wb-3378974 tnx-1000013029 cat-3378974 ##  6 wb-3380350 tnx-1000012411 cat-3380350 ##  7 wb-3380601 tnx-1000012412 cat-3380601 ##  8 wb-3380616 tnx-1000012414 cat-3380616 ##  9 wb-3380617 tnx-1000013030 cat-3380617 ## 10 wb-3380618 tnx-1000012415 cat-3380618 ## # ℹ 65,270 more rows (get_sorted(wbd_net, outlets = wbd$toid[1])) ##                id        toid   divide_id ## 31259  wb-3400765 nex-3400757 cat-3400765 ## 57189 nex-3400757  wb-3400757        <NA> ## 10252  wb-3400757 nex-3400758 cat-3400757 ## 31260  wb-3400769 nex-3400759 cat-3400769 ## 57191 nex-3400759  wb-3400759        <NA> ## 10253  wb-3400759 nex-3400758 cat-3400759 ## 10254  wb-3400760 nex-3400761 cat-3400760 ## 57192 nex-3400761  wb-3400761        <NA> ## 36799  wb-3400761 nex-3400758 cat-3400761 ## 36800  wb-3400768 nex-3400758 cat-3400768 ## 31261  wb-3400766 nex-3400762 cat-3400766 ## 57193 nex-3400762  wb-3400762        <NA> ## 10255  wb-3400762 nex-3400763 cat-3400762 ## 31262  wb-3400767 nex-3400764 cat-3400767 ## 57195 nex-3400764  wb-3400764        <NA> ## 10256  wb-3400764 nex-3400763 cat-3400764 ## 39873  wb-3400770 nex-3400763 cat-3400770 ## 57194 nex-3400763  wb-3400763        <NA> ## 39874  wb-3400763 nex-3400758 cat-3400763 ## 57190 nex-3400758  wb-3400758        <NA>"},{"path":"/articles/05-subsetting.html","id":"complete-example","dir":"Articles","previous_headings":"The CONUS network file","what":"Complete Example:","title":"Building your own subset","text":"","code":"system.time({   wbd = filter(net, hl_uri == \"HUC12-180600130201\") %>%     select(toid,  vpu, hydroseq) %>%     slice_max(hydroseq, with_ties = FALSE)   wbd_net = filter(net, vpu == wbd$vpu) %>%    select(id, toid, divide_id) %>%      distinct() %>%      get_sorted(outlets = wbd$toid) }) ##    user  system elapsed  ##   0.611   0.116   0.733 (ids = na.omit(unique(unlist(wbd_net)))) ##  [1] \"wb-3400765\"  \"nex-3400757\" \"wb-3400757\"  \"wb-3400769\"  \"nex-3400759\" ##  [6] \"wb-3400759\"  \"wb-3400760\"  \"nex-3400761\" \"wb-3400761\"  \"wb-3400768\"  ## [11] \"wb-3400766\"  \"nex-3400762\" \"wb-3400762\"  \"wb-3400767\"  \"nex-3400764\" ## [16] \"wb-3400764\"  \"wb-3400770\"  \"nex-3400763\" \"wb-3400763\"  \"nex-3400758\" ## [21] \"wb-3400758\"  \"cat-3400765\" \"cat-3400757\" \"cat-3400769\" \"cat-3400759\" ## [26] \"cat-3400760\" \"cat-3400761\" \"cat-3400768\" \"cat-3400766\" \"cat-3400762\" ## [31] \"cat-3400767\" \"cat-3400764\" \"cat-3400770\" \"cat-3400763\" ## attr(,\"na.action\") ## [1] 23 ## attr(,\"class\") ## [1] \"omit\""},{"path":"/articles/05-subsetting.html","id":"easy-integration-with-sql","dir":"Articles","previous_headings":"The CONUS network file > Complete Example:","what":"4. Easy integration with SQL","title":"Building your own subset","text":"set IDs, SQL backing GPKG allows quickly extracting features based ID set","code":"## USE GET HYDROFABRIC HERE (gpkg = get_hydrofabric(VPU = wbd$vpu, type = \"nextgen\", dir = \"cihro-data\")) ## [1] \"cihro-data/nextgen_18.gpkg\" db <- dbConnect(SQLite(), gpkg)  t = tbl(db, \"divides\") %>%       filter(if_any(any_of(c('divide_id', 'id', 'ds_id')), ~ . %in% ids)) %>%       collect()  st_as_sf(t, crs = 5070) %>%    mapview()"},{"path":"/articles/05-subsetting.html","id":"subsetting","dir":"Articles","previous_headings":"","what":"Subsetting!","title":"Building your own subset","text":"Now, conceptual straight forward, repetitively annoying. Equally, writing logic layers loop can prone easy errors. cases, provide subset_network function works o n","code":"system.time({   xx = subset_network(id = wbd$toid,                        network = \"../data/conus_net.parquet\",                       pattern = '/Volumes/Transcend/ngen/CONUS-hydrofabric/05_nextgen/nextgen_{vpu}.gpkg',                       lyrs = c(\"divides\", \"nexus\", \"flowpaths\", \"lakes\", \"flowpath_attributes\")) }) ## Starting from: `nex-3400758` ##    user  system elapsed  ##   3.367   0.803  15.207 mapview(xx$divides) + xx$nexus + xx$flowpaths lapply(xx, names) ## $divides ##  [1] \"fid\"                   \"geom\"                  \"divide_id\"             ##  [4] \"toid\"                  \"type\"                  \"ds_id\"                 ##  [7] \"areasqkm\"              \"id\"                    \"lengthkm\"              ## [10] \"tot_drainage_areasqkm\" \"has_flowline\"          ##  ## $nexus ## [1] \"fid\"    \"geom\"   \"id\"     \"toid\"   \"hl_id\"  \"hl_uri\" \"type\"   ##  ## $flowpaths ##  [1] \"fid\"                   \"geom\"                  \"id\"                    ##  [4] \"toid\"                  \"mainstem\"              \"order\"                 ##  [7] \"hydroseq\"              \"lengthkm\"              \"areasqkm\"              ## [10] \"tot_drainage_areasqkm\" \"has_divide\"            \"divide_id\"             ##  ## $lakes ##  [1] \"fid\"          \"geom\"         \"id\"           \"toid\"         \"hl_id\"        ##  [6] \"hl_reference\" \"hl_link\"      \"hl_uri\"       \"Dam_Length\"   \"ifd\"          ## [11] \"LkArea\"       \"LkMxE\"        \"OrificeA\"     \"OrificeC\"     \"OrificeE\"     ## [16] \"time\"         \"WeirC\"        \"WeirE\"        \"WeirL\"        ##  ## $flowpath_attributes ##  [1] \"fid\"                  \"id\"                   \"rl_gages\"             ##  [4] \"rl_NHDWaterbodyComID\" \"Qi\"                   \"MusK\"                 ##  [7] \"MusX\"                 \"n\"                    \"So\"                   ## [10] \"ChSlp\"                \"BtmWdth\"              \"time\"                 ## [13] \"Kchan\"                \"nCC\"                  \"TopWdthCC\"            ## [16] \"TopWdth\"              \"length_m\""},{"path":"/articles/05-subsetting.html","id":"example-for-poudre-river","dir":"Articles","previous_headings":"","what":"Example for Poudre River!","title":"Building your own subset","text":"","code":"system.time({   xx = subset_network(hl_id = 'Gages-06752260',                        network =\"../data/conus_net.parquet\",                       export_gpkg = \"cihro-data/poudre-sub.gpkg\",                       lyrs = c(\"divides\", \"nexus\", \"flowpaths\")) }) ## Starting from: `nex-278699` ## Deleting layer `layer_styles' using driver `GPKG' ##    user  system elapsed  ##   2.549   1.201  13.021 st_layers(xx) ## Driver: GPKG  ## Available layers: ##     layer_name     geometry_type features fields             crs_name ## 1      divides     Multi Polygon      419      9 NAD83 / Conus Albers ## 2        nexus             Point      171      5 NAD83 / Conus Albers ## 3    flowpaths Multi Line String      419     10 NAD83 / Conus Albers ## 4 layer_styles                NA        3     12                 <NA>"},{"path":[]},{"path":"/articles/05-subsetting.html","id":"cli-option","dir":"Articles","previous_headings":"","what":"CLI Option","title":"Building your own subset","text":"interested using NOAA NextGen fabric , provided Go-based CLI utility following syntax:","code":"hfsubset - Hydrofabric Subsetter  Usage:   hfsubset [OPTIONS] identifiers...   hfsubset (-h | --help)  Example:   hfsubset -l divides -o ./poudre-divides.gpkg -r \"pre-release\" -t hl \"Gages-06752260\"   hfsubset -o ./poudre-all.gpkg -t hl \"Gages-06752260\"  Options:   -l string         Layers to subset (default \"divides,nexus,flowpaths,network,hydrolocations\")   -o string         Output file name (default \"hydrofabric.gpkg\")   -r string         Hydrofabric version (default \"pre-release\")   -t string         One of: hf, hl, or comid (default \"hf\")"},{"path":"/articles/05-subsetting.html","id":"nextgen-needs-geojson-final-example","dir":"Articles","previous_headings":"CLI Option","what":"NextGen Needs GeoJSON: Final example","title":"Building your own subset","text":"GPKG support end goal NextGen, current requires GeoJSON CSV inputs. Fortunately, ogr2ogr provides easy ways extract sub layer/formats GPKG file. full-stop example extracting subset hydrolocation, using CLI, generating needed files NextGen","code":"cd <WHEREVER YOU WANT!> mkdir poudre cd poudre  hfsubset -l divides,nexus,flowpath_attributes -o ./poudre-subset.gpkg -r \"pre-release\" -t hl \"Gages-06752260\"  ogr2ogr -f GeoJSON catchments.geojson poudre-subset.gpkg -nln divides   ogr2ogr -f GeoJSON nexus.geojson poudre-subset.gpkg -nln nexus ogr2ogr -f CSV flowpath_attributes.csv poudre-subset.gpkg -nln flowpath_attributes  ls poudre"},{"path":"/articles/06-attribute-access.html","id":"precanned-data","dir":"Articles","previous_headings":"","what":"1. Precanned Data","title":"Attribute Access and Creation","text":"intention NextGen provide suite precomputed, useful information related release hydrofabric. date include attributes needed run CFE/NOAH-OWP, eventually include attributes found CAMELS dataset. Precanned data live directory released hydrofabric artifacts follow VPU segmentation. , can see extract information CFE Poudre subset.","code":""},{"path":"/articles/06-attribute-access.html","id":"set-up","dir":"Articles","previous_headings":"1. Precanned Data","what":"Set up","title":"Attribute Access and Creation","text":"","code":"library(arrow) ##  ## Attaching package: 'arrow' ## The following object is masked from 'package:terra': ##  ##     buffer ## The following object is masked from 'package:utils': ##  ##     timestamp # read network x = read_sf(\"cihro-data/poudre.gpkg\", \"network\")  # define variable set attr = 'cfe_noahowp'  # define path  p = glue(\"s3://nextgen-hydrofabric/pre-release/nextgen_{x$vpu[1]}_{attr}.parquet\")"},{"path":"/articles/06-attribute-access.html","id":"access-and-join","dir":"Articles","previous_headings":"1. Precanned Data","what":"Access and Join","title":"Attribute Access and Creation","text":"","code":"divides = read_sf(\"cihro-data/poudre.gpkg\", \"divides\")  # Open dataset and Join to divides divides = open_dataset(p) %>%    filter(divide_id %in% divides$divide_id) %>%    collect() %>%    right_join(divides, by = \"divide_id\") %>%    st_as_sf()"},{"path":"/articles/06-attribute-access.html","id":"explore","dir":"Articles","previous_headings":"","what":"Explore","title":"Attribute Access and Creation","text":"","code":"glimpse(divides) ## Rows: 419 ## Columns: 45 ## $ divide_id                   <chr> \"cat-278672\", \"cat-278673\", \"cat-278674\", … ## $ gw_Coeff                    <dbl> 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, … ## $ gw_Zmax                     <dbl> 247.42465, 247.42465, 247.42465, 247.42465… ## $ gw_Expon                    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, … ## $ `bexp_soil_layers_stag=1`   <dbl> 6.905784, 6.905784, 6.905784, 6.905784, 6.… ## $ `bexp_soil_layers_stag=2`   <dbl> 6.905784, 6.905784, 6.905784, 6.905784, 6.… ## $ `bexp_soil_layers_stag=3`   <dbl> 6.905784, 6.905784, 6.905784, 6.905784, 6.… ## $ `bexp_soil_layers_stag=4`   <dbl> 6.905784, 6.905784, 6.905784, 6.905784, 6.… ## $ ISLTYP                      <int> 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, … ## $ IVGTYP                      <int> 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14… ## $ `dksat_soil_layers_stag=1`  <dbl> 1.605749e-07, 1.560944e-07, 2.424650e-07, … ## $ `dksat_soil_layers_stag=2`  <dbl> 1.605749e-07, 1.560944e-07, 2.424650e-07, … ## $ `dksat_soil_layers_stag=3`  <dbl> 1.605749e-07, 1.560944e-07, 2.424650e-07, … ## $ `dksat_soil_layers_stag=4`  <dbl> 1.605749e-07, 1.560944e-07, 2.424650e-07, … ## $ `psisat_soil_layers_stag=1` <dbl> 0.09665685, 0.11262189, 0.16652204, 0.0334… ## $ `psisat_soil_layers_stag=2` <dbl> 0.09665685, 0.11262189, 0.16652204, 0.0334… ## $ `psisat_soil_layers_stag=3` <dbl> 0.09665685, 0.11262189, 0.16652204, 0.0334… ## $ `psisat_soil_layers_stag=4` <dbl> 0.09665685, 0.11262189, 0.16652204, 0.0334… ## $ cwpvt                       <dbl> 0.09246867, 0.09224170, 0.09224170, 0.0922… ## $ mfsno                       <dbl> 3.268730, 3.307741, 3.307741, 3.307741, 3.… ## $ mp                          <dbl> 9.505003, 8.412661, 8.366073, 8.368729, 8.… ## $ `quartz_soil_layers_stag=1` <dbl> 0.6000000, 0.6000000, 0.6000000, 0.6000000… ## $ `quartz_soil_layers_stag=2` <dbl> 0.6000000, 0.6000000, 0.6000000, 0.6000000… ## $ `quartz_soil_layers_stag=3` <dbl> 0.6000000, 0.6000000, 0.6000000, 0.6000000… ## $ `quartz_soil_layers_stag=4` <dbl> 0.6000000, 0.6000000, 0.6000000, 0.6000000… ## $ refkdt                      <dbl> 3.936352, 3.951302, 3.951302, 3.951302, 3.… ## $ slope                       <dbl> 0.7555849542, 0.7692162991, 0.7692162991, … ## $ `smcmax_soil_layers_stag=1` <dbl> 0.4457698, 0.4462140, 0.4462140, 0.4462140… ## $ `smcmax_soil_layers_stag=2` <dbl> 0.4457698, 0.4462140, 0.4462140, 0.4462140… ## $ `smcmax_soil_layers_stag=3` <dbl> 0.4457698, 0.4462140, 0.4462140, 0.4462140… ## $ `smcmax_soil_layers_stag=4` <dbl> 0.4457698, 0.4462140, 0.4462140, 0.4462140… ## $ `smcwlt_soil_layers_stag=1` <dbl> 0.04700000, 0.04700000, 0.04700000, 0.0470… ## $ `smcwlt_soil_layers_stag=2` <dbl> 0.04700000, 0.04700000, 0.04700000, 0.0470… ## $ `smcwlt_soil_layers_stag=3` <dbl> 0.04700000, 0.04700000, 0.04700000, 0.0470… ## $ `smcwlt_soil_layers_stag=4` <dbl> 0.04700000, 0.04700000, 0.04700000, 0.0470… ## $ vcmx25                      <dbl> 65.49842, 69.17342, 69.32784, 69.31904, 69… ## $ toid                        <chr> \"nex-278673\", \"nex-278674\", \"nex-278675\", … ## $ type                        <chr> \"network\", \"network\", \"network\", \"network\"… ## $ ds_id                       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ areasqkm                    <dbl> 20.081244, 13.325397, 1.141646, 7.440300, … ## $ id                          <chr> \"wb-278672\", \"wb-278673\", \"wb-278674\", \"wb… ## $ lengthkm                    <dbl> 9.249722, 5.541113, 1.122110, 6.340693, 5.… ## $ tot_drainage_areasqkm       <dbl> 20.08124, 51.43679, 87.73334, 186.33094, 2… ## $ has_flowline                <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, … ## $ geom                        <MULTIPOLYGON [m]> MULTIPOLYGON (((-823365 197..… plot(divides[grep('quartz_soil_layers', names(divides), value = TRUE)], border = NA) plot(divides[grep('smcmax', names(divides), value = TRUE)], border = NA)"},{"path":"/articles/06-attribute-access.html","id":"unique-use-cases","dir":"Articles","previous_headings":"","what":"2. Unique Use Cases","title":"Attribute Access and Creation","text":"Now, may want use (limited) data defined. ok ! part enterprise hydrofabric utilities/aspirations, provide tools access 100,000 different datasets without requiring download find data!","code":""},{"path":[]},{"path":"/articles/06-attribute-access.html","id":"single-day","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"Single Day","title":"Attribute Access and Creation","text":"","code":"r = getGridMET(AOI = divides, varname = \"srad\", startDate = \"2020-10-29\")  plot(r$daily_mean_shortwave_radiation_at_surface) srad = execute_zonal(r, geom = divides, fun = \"mean\", ID = \"divide_id\")  plot(srad['srad_2020-10-29'])"},{"path":"/articles/06-attribute-access.html","id":"through-time","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"Through time","title":"Attribute Access and Creation","text":"","code":"p = getGridMET(AOI = divides, varname = \"pr\", startDate = \"2023-05-10\", endDate = \"2023-05-13\")  plot(p$precipitation_amount) pr = execute_zonal(p, geom = divides, fun = \"mean\", ID = \"divide_id\")  plot(pr[grep('pr', names(pr), value = TRUE)], border = FALSE)"},{"path":"/articles/06-attribute-access.html","id":"on-the-fly-exploration","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"On the fly exploration","title":"Attribute Access and Creation","text":"want rank map NextGen Catchments amount rain received last days","code":"pr$cumpr = rank(st_drop_geometry(pr[grep('pr', names(pr), value = TRUE)]) %>% rowSums())  plot(pr['cumpr'])"},{"path":"/articles/06-attribute-access.html","id":"beyond-gridmet","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"Beyond Gridmet","title":"Attribute Access and Creation","text":"climateR provides range short cut functions common datasets. simply shortcuts make access faster:","code":"grep(\"get\", ls(\"package:climateR\"), value = TRUE) ##  [1] \"dap_get\"             \"get_data\"            \"getBCCA\"             ##  [4] \"getCHIRPS\"           \"getDaymet\"           \"getDodsrcPath\"       ##  [7] \"getGLDAS\"            \"getGridMET\"          \"getLivneh\"           ## [10] \"getLivneh_fluxes\"    \"getLOCA\"             \"getLOCA_hydro\"       ## [13] \"getMACA\"             \"getMODIS\"            \"getNetrcPath\"        ## [16] \"getNLDAS\"            \"getPRISM\"            \"getTerraClim\"        ## [19] \"getTerraClimNormals\" \"getVIC\"              \"go_get_dap_data\"     ## [22] \"vrt_crop_get\""},{"path":"/articles/06-attribute-access.html","id":"mean-monthly-normals","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29 > Beyond Gridmet","what":"Mean Monthly Normals","title":"Attribute Access and Creation","text":"","code":"ppt = getTerraClimNormals(AOI = divides,  varname = \"ppt\") %>%    execute_zonal(geom = divides, ID = \"divide_id\")  plot(ppt[grep(\"ppt\", names(ppt), value = TRUE)], border = NA) ## Warning: plotting the first 10 out of 12 attributes; use max.plot = 12 to plot ## all"},{"path":"/articles/06-attribute-access.html","id":"beyond-shortcut-functions","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"Beyond shortcut functions","title":"Attribute Access and Creation","text":"climateR-catalogs provide vast catalog resources can accessed. can find catalog element want, can passed general dap utilities.","code":"glimpse(params) ## Rows: 107,857 ## Columns: 28 ## $ id          <chr> \"maca_day\", \"maca_day\", \"maca_day\", \"maca_day\", \"maca_day\"… ## $ asset       <chr> \"agg_macav2metdata_huss_BNU-ESM_r1i1p1_historical_1950_200… ## $ URL         <glue> \"http://thredds.northwestknowledge.net:8080/thredds/dodsC… ## $ type        <chr> \"opendap\", \"opendap\", \"opendap\", \"opendap\", \"opendap\", \"op… ## $ varname     <chr> \"specific_humidity\", \"specific_humidity\", \"specific_humidi… ## $ variable    <chr> \"huss\", \"huss\", \"huss\", \"huss\", \"huss\", \"huss\", \"huss\", \"h… ## $ description <chr> \"Daily Mean Near-Surface Specific Humidity\", \"Daily Mean N… ## $ units       <chr> \"kg kg-1\", \"kg kg-1\", \"kg kg-1\", \"kg kg-1\", \"kg kg-1\", \"kg… ## $ model       <chr> \"BNU-ESM\", \"CNRM-CM5\", \"CSIRO-Mk3-6-0\", \"bcc-csm1-1\", \"Can… ## $ ensemble    <chr> \"r1i1p1\", \"r1i1p1\", \"r1i1p1\", \"r1i1p1\", \"r1i1p1\", \"r1i1p1\"… ## $ scenario    <chr> \"historical\", \"historical\", \"historical\", \"historical\", \"h… ## $ T_name      <chr> \"time\", \"time\", \"time\", \"time\", \"time\", \"time\", \"time\", \"t… ## $ duration    <chr> \"1950-01-01/2005-12-31\", \"1950-01-01/2005-12-31\", \"1950-01… ## $ interval    <chr> \"1 days\", \"1 days\", \"1 days\", \"1 days\", \"1 days\", \"1 days\"… ## $ nT          <dbl> 20454, 20454, 20454, 20454, 20454, 20454, 20454, 20454, 20… ## $ X_name      <chr> \"lon\", \"lon\", \"lon\", \"lon\", \"lon\", \"lon\", \"lon\", \"lon\", \"l… ## $ Y_name      <chr> \"lat\", \"lat\", \"lat\", \"lat\", \"lat\", \"lat\", \"lat\", \"lat\", \"l… ## $ X1          <dbl> -124.7722, -124.7722, -124.7722, -124.7722, -124.7722, -12… ## $ Xn          <dbl> -67.06476, -67.06476, -67.06476, -67.06476, -67.06476, -67… ## $ Y1          <dbl> 25.06308, 25.06308, 25.06308, 25.06308, 25.06308, 25.06308… ## $ Yn          <dbl> 49.39602, 49.39602, 49.39602, 49.39602, 49.39602, 49.39602… ## $ resX        <dbl> 0.04166599, 0.04166599, 0.04166599, 0.04166599, 0.04166599… ## $ resY        <dbl> 0.041666, 0.041666, 0.041666, 0.041666, 0.041666, 0.041666… ## $ ncols       <dbl> 1386, 1386, 1386, 1386, 1386, 1386, 1386, 1386, 1386, 1386… ## $ nrows       <dbl> 585, 585, 585, 585, 585, 585, 585, 585, 585, 585, 585, 585… ## $ crs         <chr> \"+proj=longlat +a=6378137 +f=0.00335281066474748 +pm=0 +no… ## $ toptobottom <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE… ## $ tiled       <chr> \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\", \"T\"…"},{"path":"/articles/06-attribute-access.html","id":"polaris-soils","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"POLARIS Soils","title":"Attribute Access and Creation","text":"","code":"(cat = params %>% filter(id == \"polaris\", grepl(\"alpha_mean\", asset)) ) ##         id              asset ## 1: polaris     alpha_mean_0_5 ## 2: polaris    alpha_mean_5_15 ## 3: polaris   alpha_mean_15_30 ## 4: polaris   alpha_mean_30_60 ## 5: polaris  alpha_mean_60_100 ## 6: polaris alpha_mean_100_200 ##                                                                                          URL ## 1:     /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_0_5.vrt ## 2:    /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_5_15.vrt ## 3:   /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_15_30.vrt ## 4:   /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_30_60.vrt ## 5:  /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_60_100.vrt ## 6: /vsicurl/http://hydrology.cee.duke.edu/POLARIS/PROPERTIES/v1.0/vrt/alpha_mean_100_200.vrt ##    type              varname             variable ## 1:  vrt     mean alpha 0-5cm     mean alpha 0-5cm ## 2:  vrt    mean alpha 5-15cm    mean alpha 5-15cm ## 3:  vrt   mean alpha 15-30cm   mean alpha 15-30cm ## 4:  vrt   mean alpha 30-60cm   mean alpha 30-60cm ## 5:  vrt  mean alpha 60-100cm  mean alpha 60-100cm ## 6:  vrt mean alpha 100-200cm mean alpha 100-200cm ##                                                                     description ## 1: scale parameter inversely proportional to mean pore diameter (van genuchten) ## 2: scale parameter inversely proportional to mean pore diameter (van genuchten) ## 3: scale parameter inversely proportional to mean pore diameter (van genuchten) ## 4: scale parameter inversely proportional to mean pore diameter (van genuchten) ## 5: scale parameter inversely proportional to mean pore diameter (van genuchten) ## 6: scale parameter inversely proportional to mean pore diameter (van genuchten) ##           units model ensemble scenario T_name duration interval nT X_name ## 1: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ## 2: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ## 3: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ## 4: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ## 5: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ## 6: log10(kPa-1)  <NA>     <NA>     <NA>   <NA>     <NA>     <NA> NA   <NA> ##    Y_name   X1  Xn   Y1 Yn         resX         resY  ncols nrows ## 1:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ## 2:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ## 3:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ## 4:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ## 5:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ## 6:   <NA> -125 -66 -125 50 0.0002777778 0.0002777778 212400 97200 ##                                    crs toptobottom tiled ## 1: +proj=longlat +datum=WGS84 +no_defs          NA       ## 2: +proj=longlat +datum=WGS84 +no_defs          NA       ## 3: +proj=longlat +datum=WGS84 +no_defs          NA       ## 4: +proj=longlat +datum=WGS84 +no_defs          NA       ## 5: +proj=longlat +datum=WGS84 +no_defs          NA       ## 6: +proj=longlat +datum=WGS84 +no_defs          NA alpha = dap(catalog = cat[1], AOI = divides)  plot(alpha$alpha_mean_0_5) soil = execute_zonal(alpha, geom = divides, fun = \"mean\", ID = \"divide_id\")  plot(soil['alpha_mean_0_5'])"},{"path":"/articles/06-attribute-access.html","id":"usgs-dems","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"USGS DEMs","title":"Attribute Access and Creation","text":"","code":"(cat = params %>%  filter(asset == \"30m CONUS DEM\")) ##           id         asset ## 1: USGS 3DEP 30m CONUS DEM ##                                                                                                  URL ## 1: /vsicurl/https://prd-tnm.s3.amazonaws.com/StagedProducts/Elevation/1/TIFF/USGS_Seamless_DEM_1.vrt ##    type   varname  variable   description  units model ensemble scenario T_name ## 1:  vrt elevation elevation 30m CONUS DEM meters  <NA>     <NA>     <NA>   <NA> ##    duration interval nT X_name Y_name        X1       Xn        Y1       Yn ## 1:     <NA>     <NA> NA   <NA>   <NA> -171.0017 164.0017 -171.0017 84.00167 ##            resX         resY   ncols  nrows                                 crs ## 1: 0.0002777778 0.0002777778 1206012 356412 +proj=longlat +datum=NAD83 +no_defs ##    toptobottom tiled ## 1:          NA dem = dap(catalog = cat[1], AOI = divides)  plot(dem[[1]])"},{"path":"/articles/06-attribute-access.html","id":"beyond-r","dir":"Articles","previous_headings":"2. Unique Use Cases > Gridmet solar radiation on 2020-10-29","what":"Beyond R","title":"Attribute Access and Creation","text":"USGS gdptools provides similar climateR/zonal capabilities data catalog Python","code":""},{"path":"/articles/06-attribute-access.html","id":"legacy-of-usgs-based-comid-data","dir":"Articles","previous_headings":"","what":"3. Legacy of USGS based COMID data","title":"Attribute Access and Creation","text":"wide range legacy new products produced USGS rigorously summarize 1,000’s attributes NHDPlusV2 catchment network. One particular interest NextGen TWI. TOPMODEL requires distribution, quick dirty way get NextGen catchment TWI estimates immense value.","code":"knitr::include_graphics(\"../man/figures/usgs-twi.png\")"},{"path":"/articles/06-attribute-access.html","id":"twi-joined-to-the-poudre-river-network","dir":"Articles","previous_headings":"3. Legacy of USGS based COMID data","what":"TWI joined to the Poudre River Network","title":"Attribute Access and Creation","text":"","code":"net = read_sf(\"cihro-data/poudre.gpkg\", \"network\")   twi = data.frame(comid = unique(net$hf_id)) %>%    left_join(get_vaa('areasqkm')) %>%    left_join(read_parquet('cihro-data/56f97be4e4b0a6037df06b70_tot.parquet'), by = c(\"comid\"=\"COMID\")) %>%    select(comid, areasqkm, TOT_TWI) ## Joining with `by = join_by(comid)`"},{"path":"/articles/06-attribute-access.html","id":"reference-fabric-data","dir":"Articles","previous_headings":"3. Legacy of USGS based COMID data","what":"Reference fabric data","title":"Attribute Access and Creation","text":"","code":"ref = get_hydrofabric(VPU = \"10L\", type = \"reference\", dir = \"cihro-data\") %>%    read_hydrofabric(realization = \"catchments\") %>%    magrittr::extract2(1) %>%    filter(FEATUREID %in% twi$comid) %>%    left_join(twi, by = c(\"FEATUREID\"=\"comid\"))  plot(ref['TOT_TWI'], border = NA, main = paste(nrow(ref), \" reference catchments\"))"},{"path":"/articles/06-attribute-access.html","id":"area-averaging-reference-fabric-to-nextgen","dir":"Articles","previous_headings":"3. Legacy of USGS based COMID data","what":"Area averaging reference fabric to NextGen","title":"Attribute Access and Creation","text":"limited just TWI. nhdplusTools package provides archive NHDPlusV2 based catchment datasets can used:","code":"twi2 = select(net, comid = hf_id, divide_id, areasqkm_full = areasqkm) %>%    distinct() %>%    left_join(twi) %>%   mutate(wTWI = TOT_TWI *pmin(1, areasqkm / areasqkm_full)) %>%    group_by(divide_id) %>%    summarise(twi = sum(wTWI, na.rm = TRUE))  %>%    right_join(divides) %>%    st_as_sf() ## Joining with `by = join_by(comid)` ## Joining with `by = join_by(divide_id)` plot(twi2['twi'], border = NA, main = paste(nrow(twi2), \" reference catchments\")) xx = discover_nldi_characteristics(\"all\")   lapply(xx, nrow) ## $local ## [1] 126 ##  ## $total ## [1] 127 ##  ## $divergence_routed ## [1] 126 xx$total$characteristic_id[1:10] ##  [1] \"TOT_BFI\"        \"TOT_PET\"        \"TOT_CONTACT\"    \"TOT_EWT\"        ##  [5] \"TOT_IEOF\"       \"TOT_RECHG\"      \"TOT_SATOF\"      \"TOT_TWI\"        ##  [9] \"TOT_WB5100_ANN\" \"TOT_FUNGICIDE\""},{"path":"/articles/06-attribute-access.html","id":"summary","dir":"Articles","previous_headings":"3. Legacy of USGS based COMID data","what":"Summary","title":"Attribute Access and Creation","text":"NOAA-OWP/hydrofabric provides network subsetting function preloads number software tools critical enterprise effort reference fabric built NHDPlusV2 allows minimal, improved network can manipulate refactoring aggregation meet needs variety modeling tasks NHDPlusV2 current, just possible reference, however, NHDPlusV2 legacy data Web infrastructure available. NextGen data fabrics one form refactored/aggregated network extensions modeling application. “just” want use data created, Go based API (runs hydrofab::subset_network) available want make , tools available open also provide tools start enhancing data fabrics information helps guide scientific choices, model options, understanding","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Mike Johnson. Author, maintainer. . Funder. . Funder. . Funder.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Johnson M (2023). hydrofabric: Easily Install Load 'hydrofabric' tools. R package version 0.0.6, https://github.com/NOAA-OWP/hydrofabric.","code":"@Manual{,   title = {hydrofabric: Easily Install and Load 'hydrofabric' tools},   author = {Mike Johnson},   year = {2023},   note = {R package version 0.0.6},   url = {https://github.com/NOAA-OWP/hydrofabric}, }"},{"path":"/index.html","id":"noaa-next-generation-modeling-framework-hydrofabric","dir":"","previous_headings":"","what":"NOAA Next Generation Modeling Framework Hydrofabric","title":"Easily Install and Load hydrofabric tools","text":"","code":"Johnson, J. M. (2022). National Hydrologic Geospatial Fabric (hydrofabric) for the Next Generation (NextGen) Hydrologic Modeling Framework, HydroShare, http://www.hydroshare.org/resource/129787b468aa4d55ace7b124ed27dbde"},{"path":"/index.html","id":"overview","dir":"","previous_headings":"NOAA Next Generation Modeling Framework Hydrofabric","what":"Overview","title":"Easily Install and Load hydrofabric tools","text":"repository serves two purpose. (1) provides dedicated landing page access Next Generation Modeling Framework (NextGen) hydrofabric artifacts (2) meta package R packages designed hydroscience. NextGen artifacts distributed NHDPlusV2 Vector Processing Units generated set national reference datasets built collaboration NOAA, USGS, Lynker federal water modeling efforts. artifacts designed easily updated, manipulated, quality controlled meet needs wide range modeling tasks leveraging best possible input data.","code":""},{"path":"/index.html","id":"how-do-i-get-it","dir":"","previous_headings":"","what":"How do I get it?","title":"Easily Install and Load hydrofabric tools","text":"data documentation NextGen community resources can found detailed documentation geopackage contents . NextGen artifacts publicly available partnership Lynker NOAA OWP. VPU geopackage contains tables, spatial data, lookups relevant hydrofabric data model","code":"s3://nextgen-hydrofabric/{version}/nextgen_{REGION}.gpkg s3://nextgen-hydrofabric/{version}/nextgen_{REGION}_ext.gpkg"},{"path":"/index.html","id":"package-installation","dir":"","previous_headings":"","what":"Package Installation","title":"Easily Install and Load hydrofabric tools","text":"","code":"# install.packages(\"remotes\") remotes::install_github(\"NOAA-OWP/hydrofabric\")"},{"path":"/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"Easily Install and Load hydrofabric tools","text":"library(hydrofabric) load core packages: nhdplusTools network manipulation hydrofab tool set “fabricating” multiscale hydrofabrics ngen.hydrofab NextGen extensions hydrofab climateR accessing remote data resources parameter attributes estimation zonal catchment parameter estimation Additionally load key spatial data science libraries: terra, sf, dplyr glue","code":"library(hydrofabric) ## ── Attaching packages ────────────────────────────────────────────────────────── hydrofabric0.0.6 ──  ## ✔ dplyr         1.1.1      ✔ nhdplusTools  0.6.2  ## ✔ terra         1.7.21     ✔ hydrofab      0.5.0  ## ✔ ngen.hydrofab 0.0.3      ✔ zonal         0.0.2  ## ✔ climateR      0.3.0      ✔ glue          1.6.2  ## ✔ sf            1.0.12  ## ── Conflicts ──────────────────────────────────────────────────────────── hydrofabric_conflicts() ── ## ✖ terra::intersect() masks dplyr::intersect() ## ✖ glue::trim()       masks terra::trim() ## ✖ terra::union()     masks dplyr::union()"},{"path":"/index.html","id":"background","dir":"","previous_headings":"","what":"Easily Install and Load hydrofabric tools","title":"Easily Install and Load hydrofabric tools","text":"NextGen artifacts model application dataset built meet aims NextGen. design, artifacts derived set general authoritative data products outlined figure 1 built close collaboration USGS. Figure 1 include set base data improves network topology geometry validity defining set community hydrolocations (POIs). 4 data products used build intermediate refactored network one hydrofabric network aggregated set community hydrolocations (minimal network), one aggregated consistent size (3-10 sqkm) enforced POI locations (target distribution). NextGen specifically derived target size aggregated product upcoming developments National Hydrologic Model (NHM) built community minimal network. two aggregations serve wide range federal modeling needs, focus open source software development workflows allow interested parties build networks starting either 4 reference datasets, refactored network!","code":""},{"path":"/index.html","id":"resources","dir":"","previous_headings":"","what":"Resources","title":"Easily Install and Load hydrofabric tools","text":"hydrofabric builds OGC HY_Features conceptual model, Hydrofabric Logical model, proposed Hydrofabric Data Model. reference, refactor, minimal, target hydrofabrics can accessed . high level introduction resources can found USGS Water Data blog.","code":""},{"path":"/index.html","id":"questions","dir":"","previous_headings":"","what":"Questions:","title":"Easily Install and Load hydrofabric tools","text":"Mike Johnson (Hydrofabric Lead),  Trey Flowers  (Director, OWP Analysis Prediction Division),  Fernando Salas  (Director, OWP Geospatial Intellegence Division) Disclaimer: data preliminary provisional subject revision. provided meet need timely best science. data received final approval National Oceanic Atmospheric Administration (NOAA) U.S. Geological Survey (USGS) provided condition neither NOAA, USGS, U.S. Government shall held liable damages resulting authorized unauthorized use data.","code":""},{"path":"/reference/cs_dm.html","id":null,"dir":"Reference","previous_headings":"","what":"Cross Section Data Model — cs_dm","title":"Cross Section Data Model — cs_dm","text":"Cross Section Data Model","code":""},{"path":"/reference/cs_dm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cross Section Data Model — cs_dm","text":"","code":"cs_dm"},{"path":"/reference/cs_dm.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Cross Section Data Model — cs_dm","text":"object class list length 3.","code":""},{"path":"/reference/hf_dm.html","id":null,"dir":"Reference","previous_headings":"","what":"Hydrofabric Data Model — hf_dm","title":"Hydrofabric Data Model — hf_dm","text":"Hydrofabric Data Model Hydrofabric Data Model","code":""},{"path":"/reference/hf_dm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hydrofabric Data Model — hf_dm","text":"","code":"hf_dm  hf_dm"},{"path":"/reference/hf_dm.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Hydrofabric Data Model — hf_dm","text":"object class list length 6. object class list length 6.","code":""},{"path":"/reference/hydrofabric_conflicts.html","id":null,"dir":"Reference","previous_headings":"","what":"Conflicts between the hydrofabric and other packages — hydrofabric_conflicts","title":"Conflicts between the hydrofabric and other packages — hydrofabric_conflicts","text":"function lists conflicts packages hydrofabric packages loaded.","code":""},{"path":"/reference/hydrofabric_conflicts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Conflicts between the hydrofabric and other packages — hydrofabric_conflicts","text":"","code":"hydrofabric_conflicts()"},{"path":"/reference/hydrofabric_conflicts.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Conflicts between the hydrofabric and other packages — hydrofabric_conflicts","text":"four conflicts deliberately ignored: intersect, union, setequal, setdiff dplyr. functions make base equivalents generic, negatively affect existing code.","code":""},{"path":"/reference/hydrofabric_conflicts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Conflicts between the hydrofabric and other packages — hydrofabric_conflicts","text":"","code":"hydrofabric_conflicts() #> ── Conflicts ──────────────────────────────────────── hydrofabric_conflicts() ── #> ✖ terra::intersect() masks dplyr::intersect() #> ✖ glue::trim()       masks terra::trim() #> ✖ terra::union()     masks dplyr::union()"},{"path":"/reference/hydrofabric_packages.html","id":null,"dir":"Reference","previous_headings":"","what":"List all packages in the hydrofabric — hydrofabric_packages","title":"List all packages in the hydrofabric — hydrofabric_packages","text":"List packages hydrofabric","code":""},{"path":"/reference/hydrofabric_packages.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List all packages in the hydrofabric — hydrofabric_packages","text":"","code":"hydrofabric_packages(include_self = TRUE)"},{"path":"/reference/hydrofabric_packages.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List all packages in the hydrofabric — hydrofabric_packages","text":"include_self Include hydrofabric list?","code":""},{"path":"/reference/hydrofabric_packages.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"List all packages in the hydrofabric — hydrofabric_packages","text":"","code":"hydrofabric_packages() #>  [1] \"arrow\"         \"dplyr\"         \"DBI\"           \"RSQLite\"       #>  [5] \"sf\"            \"terra\"         \"glue\"          \"nhdplusTools\"  #>  [9] \"hydrofab\"      \"ngen.hydrofab\" \"zonal\"         \"climateR\"      #> [13] \"hydrofabric\""},{"path":"/reference/subset_network.html","id":null,"dir":"Reference","previous_headings":"","what":"Subset Hydrofabric Network — subset_network","title":"Subset Hydrofabric Network — subset_network","text":"Subset Hydrofabric Network","code":""},{"path":"/reference/subset_network.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Subset Hydrofabric Network — subset_network","text":"","code":"subset_network(   id = NULL,   comid = NULL,   hl_id = NULL,   network = \"data/conus_net.parquet\",   pattern = \"/Volumes/Transcend/ngen/CONUS-hydrofabric/05_nextgen/nextgen_{vpu}.gpkg\",   lyrs = c(\"divides\", \"nexus\", \"flowpaths\", \"network\", \"hydrolocations\"),   export_gpkg = NULL )"},{"path":"/reference/subset_network.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Subset Hydrofabric Network — subset_network","text":"id hydrofabric id comid NHDPlusV2 COMID hl_id Hydrolocation URI network Network Parquet file pattern Pattern distributed VPU based GPKGS lyrs layers extract export_gpkg file path write ","code":""},{"path":"/reference/subset_network.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Subset Hydrofabric Network — subset_network","text":"file path list","code":""}]
